<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />
  <title>SLEVAO â€“ Moderace</title>
  <meta name="description" content="SLEVAO â€“ schvalovÃ¡nÃ­ nabÃ­dky z ÄekÃ¡rny." />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          boxShadow: {
            soft: "0 20px 55px rgba(0,0,0,0.45)",
          },
          borderRadius: {
            "3xl": "1.75rem",
            "4xl": "2.25rem",
          }
        }
      }
    }
  </script>

  <style>
    :root{ --bg0:#070b14; --bg1:#0b1220; }
    html,body{ height:100%; }
    body{
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(236,72,153,.20), transparent 60%),
        radial-gradient(900px 600px at 85% 15%, rgba(245,158,11,.18), transparent 55%),
        radial-gradient(900px 700px at 55% 85%, rgba(16,185,129,.12), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color:#fff;
    }
    .glass{ background: rgba(15,23,42,.55); backdrop-filter: blur(14px); }
    .focus-ring:focus{ outline:none; box-shadow: 0 0 0 3px rgba(56,189,248,.35); }
    body.modal-open{ overflow:hidden; }
    *{ -webkit-tap-highlight-color: rgba(236,72,153,.18); }
    ::-webkit-scrollbar{ height:10px; width:10px; }
    ::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.16); border-radius:999px; }
    ::-webkit-scrollbar-track{ background: rgba(255,255,255,.05); }
  </style>
</head>
<body class="min-h-screen">

<header class="sticky top-0 z-40">
  <div class="glass border-b border-white/10">
    <div class="max-w-6xl mx-auto px-4 py-3 md:py-4 flex items-center gap-3">
      <a href="./index.html" class="flex items-center gap-2">
        <span class="inline-flex h-10 w-10 rounded-2xl bg-gradient-to-br from-fuchsia-500/30 via-neutral-900 to-amber-500/20 border border-white/10 shadow-soft items-center justify-center">âœ¨</span>
        <div>
          <div class="text-lg font-extrabold">SLEVAO</div>
          <div class="text-xs text-white/60">Moderace ÄekÃ¡rny</div>
        </div>
      </a>

      <div class="ml-auto flex items-center gap-2">
        <a href="./submit.html" class="focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">â• PÅ™idat</a>
        <a href="./admin.html" class="focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">âš™ï¸ Admin</a>
      </div>
    </div>

    <div class="max-w-6xl mx-auto px-4 pb-3">
      <div class="flex flex-col md:flex-row md:items-center gap-3">
        <div class="flex-1">
          <div class="relative">
            <input id="q" type="search" placeholder="Hledej v ÄekÃ¡rnÄ›â€¦" class="focus-ring w-full h-11 rounded-2xl bg-white/5 border border-white/10 pl-11 pr-3 text-sm md:text-base placeholder:text-white/35" />
            <div class="absolute left-3 top-1/2 -translate-y-1/2 text-white/55">ğŸ”</div>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <select id="cat" class="focus-ring h-11 rounded-2xl bg-white/5 border border-white/10 px-3 text-sm">
            <option value="all">VÅ¡e</option>
            <option value="food">GURMAO Â· JÃ­dlo</option>
            <option value="stay">CHATAO Â· Pobyt</option>
            <option value="shop">SLEVAO Â· Produkty</option>
          </select>
          <div class="text-xs text-white/60">ÄŒekÃ¡: <span id="count">0</span></div>
          <button id="btnClear" class="focus-ring h-11 px-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">Vymazat ÄekÃ¡rnu</button>
        </div>
      </div>
    </div>
  </div>
</header>

<main class="max-w-6xl mx-auto px-4 py-6 md:py-10">
  <section class="grid lg:grid-cols-[1fr_420px] gap-5">

    <!-- LIST -->
    <div class="rounded-4xl border border-white/10 bg-white/5 shadow-soft overflow-hidden">
      <div class="p-4 border-b border-white/10 flex items-center justify-between">
        <div class="font-extrabold">ÄŒekÃ¡rna</div>
        <div class="text-xs text-white/60">Klikni na Å™Ã¡dek pro detail</div>
      </div>
      <div id="list" class="divide-y divide-white/10"></div>
      <div id="empty" class="hidden p-8 text-center">
        <div class="text-3xl">ğŸ«¥</div>
        <div class="mt-2 font-extrabold text-lg">ÄŒekÃ¡rna je prÃ¡zdnÃ¡</div>
        <div class="mt-1 text-sm text-white/70">NÄ›kdo musÃ­ nejdÅ™Ã­v poslat nabÃ­dku pÅ™es <b>submit.html</b>.</div>
      </div>
    </div>

    <!-- PREVIEW -->
    <aside class="rounded-4xl border border-white/10 bg-white/5 shadow-soft overflow-hidden">
      <div class="p-4 border-b border-white/10 flex items-center justify-between">
        <div class="font-extrabold">NÃ¡hled</div>
        <div class="text-xs text-white/60">co se schvÃ¡lÃ­</div>
      </div>
      <div class="p-4">
        <div class="rounded-4xl border border-white/10 bg-white/5 overflow-hidden">
          <div class="aspect-[4/5] bg-black relative">
            <img id="pImg" alt="" class="w-full h-full object-cover" />
            <div class="absolute inset-0 bg-gradient-to-t from-black/75 via-black/10 to-black/35"></div>
            <div class="absolute top-3 left-3 right-3 flex items-center justify-between gap-2">
              <div id="pBadge" class="inline-flex items-center gap-2 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">âœ¨ SLEVAO</div>
              <div class="h-10 px-3 rounded-2xl bg-white/10 border border-white/15 grid place-items-center">ğŸ•’</div>
            </div>
            <div class="absolute bottom-3 left-3 right-3">
              <div class="flex flex-wrap items-center gap-2">
                <span id="pDisc" class="inline-flex items-center gap-1 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">ğŸ·ï¸ <b class="font-extrabold">-0%</b></span>
                <span id="pExp" class="inline-flex items-center gap-1 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">â³ PlatÃ­</span>
                <span id="pTag" class="inline-flex items-center gap-1 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">#</span>
              </div>
              <div id="pTitle" class="mt-2 text-lg font-extrabold leading-tight">â€”</div>
              <div id="pSub" class="mt-1 text-sm text-white/75">â€”</div>
              <div class="mt-3 flex items-center justify-between">
                <div class="text-sm">
                  <span id="pOld" class="line-through text-white/40">0 KÄ</span>
                  <span id="pNew" class="ml-2 font-extrabold">0 KÄ</span>
                </div>
                <div class="h-10 px-4 rounded-2xl bg-white/10 border border-white/15 grid place-items-center text-sm">SchvÃ¡lit</div>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-4 flex flex-wrap gap-2">
          <button id="btnApprove" class="focus-ring h-11 px-5 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-sky-500/10 border border-white/10 hover:opacity-95">âœ… SchvÃ¡lit</button>
          <button id="btnReject" class="focus-ring h-11 px-5 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">â›” ZamÃ­tnout</button>
          <button id="btnDelete" class="focus-ring h-11 px-5 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">ğŸ—‘ï¸ Smazat</button>
          <a id="btnOpenAdmin" href="./admin.html" class="focus-ring h-11 px-5 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 inline-flex items-center">âš™ï¸ OtevÅ™Ã­t admin</a>
        </div>

        <div class="mt-4 rounded-3xl border border-white/10 bg-white/5 p-3">
          <div class="text-xs text-white/60">Detail ÄekÃ¡rny</div>
          <div id="meta" class="mt-1 text-sm text-white/80">â€”</div>
        </div>
      </div>
    </aside>

  </section>
</main>

<!-- TOAST -->
<div id="toast" class="hidden fixed left-1/2 -translate-x-1/2 bottom-6 z-[60]">
  <div class="rounded-2xl border border-white/10 bg-[#0b1220] shadow-soft px-4 py-3 text-sm"></div>
</div>

<script>
  const KEY_PENDING = 'slevao_pending_v1';
  const KEY_OFFERS = 'slevao_offers_v1';

  const $ = (s,r=document)=>r.querySelector(s);
  const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));
  const safeJson = (v,f)=>{ try{return JSON.parse(v)}catch(e){return f} };
  const fmtCZK = (n) => new Intl.NumberFormat('cs-CZ').format(Math.round(Number(n)||0)) + ' KÄ';

  const el = {
    q: $('#q'),
    cat: $('#cat'),
    count: $('#count'),
    btnClear: $('#btnClear'),
    list: $('#list'),
    empty: $('#empty'),

    pImg: $('#pImg'),
    pBadge: $('#pBadge'),
    pDisc: $('#pDisc'),
    pExp: $('#pExp'),
    pTag: $('#pTag'),
    pTitle: $('#pTitle'),
    pSub: $('#pSub'),
    pOld: $('#pOld'),
    pNew: $('#pNew'),

    btnApprove: $('#btnApprove'),
    btnReject: $('#btnReject'),
    btnDelete: $('#btnDelete'),
    btnOpenAdmin: $('#btnOpenAdmin'),

    meta: $('#meta'),
    toast: $('#toast')
  };

  let pending = [];
  let currentPid = null;

  function toast(msg){
    el.toast.firstElementChild.textContent = msg;
    el.toast.classList.remove('hidden');
    setTimeout(()=> el.toast.classList.add('hidden'), 2200);
  }

  function expLabel(d){
    d = Number(d||0);
    if(d===0) return 'KonÄÃ­ dnes';
    if(d===1) return 'KonÄÃ­ zÃ­tra';
    if(d<=7) return `KonÄÃ­ za ${d} dny`;
    return `PlatÃ­ jeÅ¡tÄ› ${d} dnÃ­`;
  }

  function catLabel(cat){
    if(cat==='food') return 'ğŸ” GURMAO Â· JÃ­dlo';
    if(cat==='stay') return 'ğŸ•ï¸ CHATAO Â· Pobyt';
    return 'ğŸ›ï¸ SLEVAO Â· Produkty';
  }

  function loadPending(){
    const arr = safeJson(localStorage.getItem(KEY_PENDING), []);
    return Array.isArray(arr) ? arr : [];
  }
  function savePending(arr){
    localStorage.setItem(KEY_PENDING, JSON.stringify(Array.isArray(arr)?arr:[]));
  }
  function loadOffers(){
    const arr = safeJson(localStorage.getItem(KEY_OFFERS), []);
    return Array.isArray(arr) ? arr : [];
  }
  function saveOffers(arr){
    localStorage.setItem(KEY_OFFERS, JSON.stringify(Array.isArray(arr)?arr:[]));
  }

  function escapeHtml(str){
    return String(str||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
  }

  function rowHTML(o){
    const t0 = (o.tags && o.tags[0]) ? `#${o.tags[0]}` : '';
    const when = new Date(o.createdAt || Date.now());
    const whenStr = `${when.toLocaleDateString('cs-CZ')} ${when.toLocaleTimeString('cs-CZ', {hour:'2-digit', minute:'2-digit'})}`;

    return `
      <button class="row w-full text-left p-4 hover:bg-white/10 transition" data-pid="${escapeHtml(o.pid)}">
        <div class="flex items-start gap-3">
          <div class="h-12 w-12 rounded-2xl bg-white/5 border border-white/10 grid place-items-center">ğŸ•’</div>
          <div class="flex-1 min-w-0">
            <div class="flex items-center gap-2">
              <div class="font-extrabold truncate">${escapeHtml(o.title)}</div>
              <span class="text-xs px-2 py-0.5 rounded-full border border-white/10 bg-white/5 text-white/70">-${Number(o.discount||0)}%</span>
              ${t0 ? `<span class="text-xs px-2 py-0.5 rounded-full border border-white/10 bg-white/5 text-white/60">${escapeHtml(t0)}</span>` : ''}
            </div>
            <div class="mt-0.5 text-xs text-white/60 truncate">${escapeHtml(catLabel(o.cat))} â€¢ ${escapeHtml(expLabel(o.expiresInDays))} â€¢ ${whenStr}</div>
            <div class="mt-1 text-sm text-white/75 truncate">${escapeHtml(o.subtitle||'')}</div>
          </div>
          <div class="text-right">
            <div class="text-xs text-white/50 line-through">${fmtCZK(o.oldPrice||0)}</div>
            <div class="font-extrabold">${fmtCZK(o.newPrice||0)}</div>
          </div>
        </div>
      </button>
    `;
  }

  function applyFilters(arr){
    const q = (el.q.value||'').trim().toLowerCase();
    const c = el.cat.value || 'all';
    return arr.filter(o => {
      if(c !== 'all' && o.cat !== c) return false;
      if(!q) return true;
      const hay = `${o.title} ${o.subtitle} ${(o.tags||[]).join(' ')} ${o.city||''} ${o.contact||''}`.toLowerCase();
      return hay.includes(q);
    });
  }

  function setPreview(o){
    const img = o?.img || 'https://images.unsplash.com/photo-1520975682031-a4fe3c694bcd?auto=format&fit=crop&w=1600&q=80';
    el.pImg.src = img;
    el.pBadge.textContent = catLabel(o?.cat);
    el.pDisc.innerHTML = `ğŸ·ï¸ <b class="font-extrabold">-${Number(o?.discount||0)}%</b>`;
    el.pExp.textContent = `â³ ${expLabel(o?.expiresInDays)}`;
    el.pTag.textContent = `#${(o?.tags && o.tags[0]) ? o.tags[0] : 'sleva'}`;
    el.pTitle.textContent = o?.title || 'â€”';
    el.pSub.textContent = o?.subtitle || 'â€”';
    el.pOld.textContent = fmtCZK(o?.oldPrice||0);
    el.pNew.textContent = fmtCZK(o?.newPrice||0);

    const when = new Date(o?.createdAt || Date.now());
    const whenStr = `${when.toLocaleDateString('cs-CZ')} ${when.toLocaleTimeString('cs-CZ',{hour:'2-digit', minute:'2-digit'})}`;

    el.meta.innerHTML = `
      <div><b>pid:</b> ${escapeHtml(o?.pid||'â€”')}</div>
      <div><b>id (budoucÃ­):</b> ${escapeHtml(o?.id||'â€”')}</div>
      <div><b>Kontakt:</b> ${escapeHtml(o?.contact||'â€”')}</div>
      <div><b>MÄ›sto:</b> ${escapeHtml(o?.city||'â€”')}</div>
      <div><b>VytvoÅ™eno:</b> ${escapeHtml(whenStr)}</div>
      <div class="mt-2"><b>Popis:</b> ${escapeHtml(o?.story||'â€”')}</div>
    `;

    // admin link (zatÃ­m jen otevÅ™e admin)
    el.btnOpenAdmin.href = `./admin.html?t=${Date.now()}`;
  }

  function render(){
    const shown = applyFilters(pending);
    el.count.textContent = String(shown.length);

    el.list.innerHTML = shown.map(rowHTML).join('');
    el.empty.classList.toggle('hidden', shown.length !== 0);

    $$('.row', el.list).forEach(b => {
      b.addEventListener('click', ()=>{
        const pid = b.getAttribute('data-pid');
        openItem(pid);
      });
    });

    if(shown[0]) openItem(shown[0].pid);
    else {
      currentPid = null;
      setPreview(null);
    }
  }

  function openItem(pid){
    const o = pending.find(x=>String(x.pid)===String(pid));
    if(!o) return;
    currentPid = o.pid;
    setPreview(o);
  }

  function removeFromPending(pid){
    pending = pending.filter(x=>String(x.pid)!==String(pid));
    savePending(pending);
  }

  function approve(pid){
    const o = pending.find(x=>String(x.pid)===String(pid));
    if(!o) return;

    // vloÅ¾Ã­me do offers (produkÄnÃ­ feed)
    const offers = loadOffers();

    // pokud existuje stejnÃ½ id, pÅ™epÃ­Å¡eme
    const idx = offers.findIndex(x=>String(x.id)===String(o.id));
    const offerLike = {
      id: o.id,
      cat: o.cat,
      source: o.source,
      title: o.title,
      subtitle: o.subtitle,
      story: o.story,
      img: o.img,
      link: o.link,
      discount: Number(o.discount||0),
      oldPrice: Number(o.oldPrice||0),
      newPrice: Number(o.newPrice||0),
      expiresInDays: Number(o.expiresInDays||0),
      tags: Array.isArray(o.tags) ? o.tags : []
    };

    if(idx >= 0) offers[idx] = offerLike;
    else offers.unshift(offerLike);

    saveOffers(offers);
    removeFromPending(pid);
    toast('SchvÃ¡leno âœ… (je ve feedu)');
    render();
  }

  function reject(pid){
    const o = pending.find(x=>String(x.pid)===String(pid));
    if(!o) return;
    // zatÃ­m jen odstranÃ­me z ÄekÃ¡rny
    removeFromPending(pid);
    toast('ZamÃ­tnuto â›”');
    render();
  }

  function hardDelete(pid){
    removeFromPending(pid);
    toast('SmazÃ¡no ğŸ—‘ï¸');
    render();
  }

  // bind
  el.q.addEventListener('input', render);
  el.cat.addEventListener('change', render);

  el.btnApprove.addEventListener('click', ()=>{
    if(!currentPid) return toast('Vyber poloÅ¾ku');
    approve(currentPid);
  });
  el.btnReject.addEventListener('click', ()=>{
    if(!currentPid) return toast('Vyber poloÅ¾ku');
    if(!confirm('ZamÃ­tnout tuto nabÃ­dku?')) return;
    reject(currentPid);
  });
  el.btnDelete.addEventListener('click', ()=>{
    if(!currentPid) return toast('Vyber poloÅ¾ku');
    if(!confirm('Smazat tuto nabÃ­dku z ÄekÃ¡rny?')) return;
    hardDelete(currentPid);
  });

  el.btnClear.addEventListener('click', ()=>{
    if(!confirm('Vymazat celou ÄekÃ¡rnu?')) return;
    pending = [];
    savePending(pending);
    toast('ÄŒekÃ¡rna vymazÃ¡na');
    render();
  });

  // init
  pending = loadPending();
  render();
  toast('Moderace pÅ™ipravena ğŸ§°');
</script>
</body>
</html>
