<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />
  <title>SLEVAO â€“ NejkrÃ¡snÄ›jÅ¡Ã­ slevy internetu</title>
  <meta name="description" content="SLEVAO â€“ instagramovÃ½ feed slev: jÃ­dlo, chaty, produkty. UklÃ¡dÃ¡nÃ­ do kolekcÃ­, filtry, detail v overlayi." />

  <!-- Tailwind CDN (rychlÃ½ start) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          boxShadow: {
            soft: "0 20px 55px rgba(0,0,0,0.45)",
            glow: "0 0 0 1px rgba(255,255,255,0.08), 0 18px 60px rgba(236,72,153,0.20)",
          },
          borderRadius: {
            "3xl": "1.75rem",
            "4xl": "2.25rem",
          },
          keyframes: {
            floaty: {"0%,100%": { transform: "translateY(0)" }, "50%": { transform: "translateY(-6px)" }},
            shimmer: {"0%": { transform: "translateX(-120%)" }, "100%": { transform: "translateX(120%)" }},
            pop: {"0%": { transform: "scale(.98)", opacity: ".0" }, "100%": { transform: "scale(1)", opacity: "1" }},
          },
          animation: {
            floaty: "floaty 4s ease-in-out infinite",
            shimmer: "shimmer 1.8s ease-in-out infinite",
            pop: "pop .18s ease-out both",
          }
        }
      }
    }
  </script>

  <style>
    /* JemnÃ½ polish navÃ­c (zÅ¯stÃ¡vÃ¡ to v jednom souboru pro start) */
    :root{
      --bg0:#070b14;
      --bg1:#0b1220;
      --card:#0f172a;
      --muted:rgba(255,255,255,.72);
      --muted2:rgba(255,255,255,.55);
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.08);
      --pink:#ec4899;
      --amber:#f59e0b;
      --emerald:#10b981;
      --sky:#38bdf8;
    }
    html,body{ height:100%; }
    body{ background: radial-gradient(1200px 700px at 15% 10%, rgba(236,72,153,.20), transparent 60%),
                     radial-gradient(900px 600px at 85% 15%, rgba(245,158,11,.18), transparent 55%),
                     radial-gradient(900px 700px at 55% 85%, rgba(16,185,129,.12), transparent 60%),
                     linear-gradient(180deg, var(--bg0), var(--bg1));
          color: #fff;
    }
    /* hezkÃ© scroll bary */
    ::-webkit-scrollbar{ height: 10px; width: 10px; }
    ::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.16); border-radius: 999px; }
    ::-webkit-scrollbar-track{ background: rgba(255,255,255,.05); }

    /* skeleton */
    .skeleton{ position:relative; overflow:hidden; background: rgba(255,255,255,.06); }
    .skeleton::after{ content:""; position:absolute; inset:0; background: linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);
      transform: translateX(-120%); animation: shimmer 1.6s ease-in-out infinite; }
    @keyframes shimmer{ 0%{ transform: translateX(-120%);} 100%{ transform: translateX(120%);} }

    /* safe-area */
    .safe-bottom{ padding-bottom: max(1rem, env(safe-area-inset-bottom)); }

    /* clamp text */
    .clamp-2{ display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient: vertical; overflow:hidden; }
    .clamp-3{ display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient: vertical; overflow:hidden; }

    /* prevent body scroll when modal open */
    body.modal-open{ overflow:hidden; }

    /* focus ring */
    .focus-ring:focus{ outline:none; box-shadow: 0 0 0 3px rgba(56,189,248,.35); }

    /* subtle glass */
    .glass{ background: rgba(15,23,42,.55); backdrop-filter: blur(14px); }

    /* tap highlight */
    *{ -webkit-tap-highlight-color: rgba(236,72,153,.18); }
  </style>
</head>

<body class="min-h-screen">

  <!-- Top bar -->
  <header class="sticky top-0 z-40">
    <div class="glass border-b border-white/10">
      <div class="max-w-6xl mx-auto px-4 py-3 md:py-4 flex items-center gap-3">

        <!-- Logo -->
        <button id="btnHome" class="group flex items-center gap-2" title="DomÅ¯">
          <span class="inline-flex h-10 w-10 rounded-2xl bg-gradient-to-br from-fuchsia-500/30 via-neutral-900 to-amber-500/20 border border-white/10 shadow-soft items-center justify-center">
            <span class="text-xl">âœ¨</span>
          </span>
          <div class="leading-tight">
            <div class="flex items-center gap-2">
              <span class="text-lg md:text-xl font-extrabold tracking-tight">SLEVAO</span>
              <span class="hidden sm:inline-flex text-xs px-2 py-0.5 rounded-full border border-white/10 bg-white/5 text-white/70">Beta</span>
            </div>
            <div class="text-xs text-white/60 -mt-0.5">NejkrÃ¡snÄ›jÅ¡Ã­ slevy internetu</div>
          </div>
        </button>

        <!-- Search -->
        <div class="flex-1">
          <div class="relative">
            <input id="q" type="search" placeholder="Hledej: burger, vÃ­Å™ivka, kÃ¡va, hodinkyâ€¦" class="focus-ring w-full h-11 rounded-2xl bg-white/5 border border-white/10 pl-11 pr-24 text-sm md:text-base placeholder:text-white/35" />
            <div class="absolute left-3 top-1/2 -translate-y-1/2 text-white/55">ğŸ”</div>
            <div class="absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-2">
              <button id="btnFilters" class="focus-ring h-9 px-3 rounded-xl bg-white/7 border border-white/10 text-xs md:text-sm hover:bg-white/10">Filtry</button>
              <button id="btnSaved" class="focus-ring h-9 px-3 rounded-xl bg-gradient-to-br from-fuchsia-500/20 to-amber-500/10 border border-white/10 text-xs md:text-sm hover:opacity-95">UloÅ¾enÃ©</button>
            </div>
          </div>
        </div>

        <!-- Profile pill (demo) -->
        <button id="btnProfile" class="hidden md:flex items-center gap-2 h-11 px-3 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 focus-ring">
          <span class="h-8 w-8 rounded-2xl bg-gradient-to-br from-sky-500/25 to-emerald-500/15 border border-white/10 grid place-items-center">ğŸ™‚</span>
          <div class="text-left leading-tight">
            <div class="text-sm font-semibold">Host</div>
            <div class="text-xs text-white/55">Bez ÃºÄtu</div>
          </div>
        </button>
      </div>

      <!-- Category tabs -->
      <div class="max-w-6xl mx-auto px-4 pb-3">
        <div class="flex flex-wrap items-center gap-2">
          <button data-cat="all" class="catBtn focus-ring h-10 px-4 rounded-2xl bg-white/7 border border-white/10 text-sm hover:bg-white/10">VÅ¡e</button>
          <button data-cat="food" class="catBtn focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 text-sm hover:bg-white/10">GURMAO Â· JÃ­dlo</button>
          <button data-cat="stay" class="catBtn focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 text-sm hover:bg-white/10">CHATAO Â· Pobyt</button>
          <button data-cat="shop" class="catBtn focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 text-sm hover:bg-white/10">SLEVAO Â· Produkty</button>

          <div class="ml-auto flex items-center gap-2">
            <button id="btnSort" class="focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 text-sm hover:bg-white/10">Å˜azenÃ­</button>
            <button id="btnRandom" class="focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 text-sm hover:bg-white/10">PÅ™ekvap mÄ›</button>
          </div>
        </div>

        <!-- micro bar -->
        <div class="mt-3 flex items-center justify-between text-xs text-white/60">
          <div id="metaLine">NaÄÃ­tÃ¡m nabÃ­dkyâ€¦</div>
          <div class="flex items-center gap-3">
            <div class="hidden sm:flex items-center gap-1">
              <span class="inline-block h-2 w-2 rounded-full bg-emerald-400/80"></span>
              <span>Å¾ivÃ½ feed</span>
            </div>
            <div class="hidden sm:block">â€¢</div>
            <div class="hidden sm:block">UloÅ¾eno: <span id="savedCount">0</span></div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main layout -->
  <main class="max-w-6xl mx-auto px-4 py-6 md:py-8">

    <!-- Hero strip (wow) -->
    <section class="mb-6 md:mb-8">
      <div class="relative overflow-hidden rounded-4xl border border-white/10 shadow-glow">
        <div class="absolute -inset-40 opacity-60 bg-[radial-gradient(circle_at_0_0,rgba(236,72,153,.35),transparent_55%),radial-gradient(circle_at_100%_0,rgba(245,158,11,.25),transparent_55%),radial-gradient(circle_at_60%_100%,rgba(16,185,129,.18),transparent_60%)]"></div>
        <div class="relative p-5 md:p-7">
          <div class="flex flex-col md:flex-row md:items-end gap-5">
            <div class="flex-1">
              <div class="inline-flex items-center gap-2 text-xs px-3 py-1 rounded-full border border-white/10 bg-white/5">
                <span>ğŸš€</span>
                <span class="text-white/70">Slevy jako Instagram</span>
              </div>
              <h1 class="mt-3 text-2xl md:text-4xl font-extrabold tracking-tight">
                Scrolluj, uklÃ¡dej, ber.
                <span class="block text-white/65 font-semibold">JÃ­dlo Â· Pobyt Â· Produkty</span>
              </h1>
              <p class="mt-3 text-sm md:text-base text-white/70 max-w-2xl">
                Tady nejsou slevy v tabulkÃ¡ch. Tady jsou <span class="text-white font-semibold">v kartÃ¡ch</span>.
                KaÅ¾dÃ¡ nabÃ­dka mÃ¡ fotku, pÅ™Ã­bÄ›h a jasnÃ© tlaÄÃ­tko: <span class="text-white font-semibold">â€VzÃ­t se slevouâ€œ</span>.
              </p>

              <div class="mt-4 flex flex-wrap items-center gap-2">
                <button id="btnHot" class="focus-ring h-11 px-5 rounded-2xl bg-gradient-to-br from-fuchsia-500/25 via-neutral-900 to-amber-500/15 border border-white/10 hover:opacity-95">
                  ğŸ”¥ DneÅ¡nÃ­ bomby
                </button>
                <button id="btnNear" class="focus-ring h-11 px-5 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">
                  ğŸ“ Okolo mÄ› (demo)
                </button>
                <button id="btnCollections" class="focus-ring h-11 px-5 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">
                  ğŸ’¾ Moje kolekce
                </button>
              </div>
            </div>

            <!-- Stats pill -->
            <div class="w-full md:w-[360px]">
              <div class="rounded-3xl border border-white/10 bg-white/5 p-4">
                <div class="flex items-center justify-between">
                  <div class="text-sm font-semibold">Dnes ve feedu</div>
                  <div class="text-xs text-white/60">aktualizace 24/7</div>
                </div>
                <div class="mt-3 grid grid-cols-3 gap-2 text-center">
                  <div class="rounded-2xl bg-white/5 border border-white/10 p-3">
                    <div class="text-lg font-extrabold" id="statAll">â€”</div>
                    <div class="text-[11px] text-white/60">nabÃ­dek</div>
                  </div>
                  <div class="rounded-2xl bg-white/5 border border-white/10 p-3">
                    <div class="text-lg font-extrabold" id="statHot">â€”</div>
                    <div class="text-[11px] text-white/60">hot</div>
                  </div>
                  <div class="rounded-2xl bg-white/5 border border-white/10 p-3">
                    <div class="text-lg font-extrabold" id="statSaved">â€”</div>
                    <div class="text-[11px] text-white/60">uloÅ¾eno</div>
                  </div>
                </div>

                <div class="mt-3 text-xs text-white/60">
                  Tip: OtevÅ™i kartu a swipuj dalÅ¡Ã­ jako reels.
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Feed -->
    <section>
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg md:text-xl font-extrabold tracking-tight">Feed</h2>
        <div class="text-xs text-white/60">Klikni na kartu pro detail</div>
      </div>

      <!-- Grid -->
      <div id="feed" class="grid gap-4 md:gap-5 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3"></div>

      <!-- Empty -->
      <div id="empty" class="hidden mt-10 rounded-4xl border border-white/10 bg-white/5 p-8 text-center">
        <div class="text-3xl">ğŸ«¥</div>
        <div class="mt-2 font-extrabold text-lg">Nic nenalezeno</div>
        <div class="mt-1 text-sm text-white/70">Zkus jinÃ© slovo, nebo uvolni filtry.</div>
        <button id="btnReset" class="mt-5 h-11 px-6 rounded-2xl bg-white/7 border border-white/10 hover:bg-white/10 focus-ring">Reset filtrÅ¯</button>
      </div>

      <!-- Footer note -->
      <div class="mt-10 safe-bottom text-center text-xs text-white/45">
        <div>Â© <span id="year"></span> SLEVAO Â· prototyp MVP</div>
        <div class="mt-1">Data jsou demo (lokÃ¡lnÄ›). NapojenÃ­ na backend udÄ›lÃ¡me v dalÅ¡Ã­m kroku.</div>
      </div>
    </section>
  </main>

  <!-- Bottom nav (mobile) -->
  <nav class="fixed bottom-0 left-0 right-0 z-40 md:hidden">
    <div class="glass border-t border-white/10 safe-bottom">
      <div class="max-w-6xl mx-auto px-4 py-3">
        <div class="grid grid-cols-4 gap-2">
          <button class="navBtn focus-ring rounded-2xl h-12 bg-white/5 border border-white/10" data-nav="home">ğŸ <div class="text-[10px] text-white/60 -mt-0.5">Feed</div></button>
          <button class="navBtn focus-ring rounded-2xl h-12 bg-white/5 border border-white/10" data-nav="filters">ğŸ›ï¸<div class="text-[10px] text-white/60 -mt-0.5">Filtry</div></button>
          <button class="navBtn focus-ring rounded-2xl h-12 bg-white/5 border border-white/10" data-nav="saved">ğŸ’¾<div class="text-[10px] text-white/60 -mt-0.5">UloÅ¾enÃ©</div></button>
          <button class="navBtn focus-ring rounded-2xl h-12 bg-white/5 border border-white/10" data-nav="profile">ğŸ™‚<div class="text-[10px] text-white/60 -mt-0.5">Profil</div></button>
        </div>
      </div>
    </div>
  </nav>

  <!-- ============== FILTERS SHEET ============== -->
  <div id="filtersModal" class="hidden fixed inset-0 z-50">
    <div id="filtersBackdrop" class="absolute inset-0 bg-black/60"></div>
    <div class="absolute left-0 right-0 bottom-0">
      <div class="max-w-6xl mx-auto px-3">
        <div id="filtersPanel" class="animate-pop rounded-t-4xl border border-white/10 bg-[#0b1220] shadow-soft overflow-hidden">
          <div class="p-4 border-b border-white/10 flex items-center justify-between">
            <div class="font-extrabold">Filtry</div>
            <button id="filtersClose" class="focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">ZavÅ™Ã­t</button>
          </div>
          <div class="p-4 md:p-5 grid md:grid-cols-2 gap-4">

            <div class="rounded-3xl border border-white/10 bg-white/5 p-4">
              <div class="text-sm font-semibold">Sleva</div>
              <div class="mt-3 grid grid-cols-3 gap-2">
                <button class="pill" data-disc="0">VÅ¡e</button>
                <button class="pill" data-disc="10">10%+</button>
                <button class="pill" data-disc="25">25%+</button>
                <button class="pill" data-disc="40">40%+</button>
                <button class="pill" data-disc="60">60%+</button>
                <button class="pill" data-disc="80">80%+</button>
              </div>
              <div class="mt-3 text-xs text-white/60">Filtrujeme podle procent (kdyÅ¾ je uvedeno).</div>
            </div>

            <div class="rounded-3xl border border-white/10 bg-white/5 p-4">
              <div class="text-sm font-semibold">Platnost</div>
              <div class="mt-3 grid grid-cols-2 gap-2">
                <button class="pill" data-exp="all">VÅ¡e</button>
                <button class="pill" data-exp="today">KonÄÃ­ dnes</button>
                <button class="pill" data-exp="week">Do 7 dnÃ­</button>
                <button class="pill" data-exp="long">DlouhodobÃ©</button>
              </div>
              <div class="mt-3 text-xs text-white/60">Platnost je demo (simulovanÃ¡).</div>
            </div>

            <div class="rounded-3xl border border-white/10 bg-white/5 p-4">
              <div class="text-sm font-semibold">CenovÃ½ rozsah</div>
              <div class="mt-3 grid grid-cols-2 gap-2">
                <label class="text-xs text-white/65">Od (KÄ)
                  <input id="priceMin" type="number" class="mt-1 focus-ring w-full h-11 rounded-2xl bg-white/5 border border-white/10 px-3" placeholder="0" />
                </label>
                <label class="text-xs text-white/65">Do (KÄ)
                  <input id="priceMax" type="number" class="mt-1 focus-ring w-full h-11 rounded-2xl bg-white/5 border border-white/10 px-3" placeholder="99999" />
                </label>
              </div>
              <div class="mt-3 text-xs text-white/60">U pobytÅ¯ je to cena od / noc (demo).</div>
            </div>

            <div class="rounded-3xl border border-white/10 bg-white/5 p-4">
              <div class="text-sm font-semibold">Å tÃ­tky</div>
              <div class="mt-3 flex flex-wrap gap-2" id="tagsBox"></div>
              <div class="mt-3 text-xs text-white/60">KliknutÃ­m pÅ™idÃ¡Å¡/odebereÅ¡ Å¡tÃ­tek.</div>
            </div>

          </div>

          <div class="p-4 border-t border-white/10 flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-between">
            <div class="text-xs text-white/60">AktivnÃ­ filtry: <span id="filtersMeta">â€”</span></div>
            <div class="flex gap-2">
              <button id="btnClearFilters" class="focus-ring h-11 px-5 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">Vymazat</button>
              <button id="btnApplyFilters" class="focus-ring h-11 px-5 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-sky-500/10 border border-white/10 hover:opacity-95">PouÅ¾Ã­t</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============== SORT SHEET ============== -->
  <div id="sortModal" class="hidden fixed inset-0 z-50">
    <div id="sortBackdrop" class="absolute inset-0 bg-black/60"></div>
    <div class="absolute left-0 right-0 bottom-0">
      <div class="max-w-6xl mx-auto px-3">
        <div class="animate-pop rounded-t-4xl border border-white/10 bg-[#0b1220] shadow-soft overflow-hidden">
          <div class="p-4 border-b border-white/10 flex items-center justify-between">
            <div class="font-extrabold">Å˜azenÃ­</div>
            <button id="sortClose" class="focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">ZavÅ™Ã­t</button>
          </div>
          <div class="p-4 grid gap-2">
            <button class="sortOpt focus-ring h-12 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 text-left px-4" data-sort="relevance">â­ DoporuÄenÃ©</button>
            <button class="sortOpt focus-ring h-12 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 text-left px-4" data-sort="discount">ğŸ·ï¸ NejvyÅ¡Å¡Ã­ sleva</button>
            <button class="sortOpt focus-ring h-12 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 text-left px-4" data-sort="priceLow">ğŸ’¸ NejlevnÄ›jÅ¡Ã­</button>
            <button class="sortOpt focus-ring h-12 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 text-left px-4" data-sort="ending">â³ KonÄÃ­ nejdÅ™Ã­v</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============== SAVED / COLLECTIONS ============== -->
  <div id="savedModal" class="hidden fixed inset-0 z-50">
    <div id="savedBackdrop" class="absolute inset-0 bg-black/60"></div>
    <div class="absolute inset-x-0 bottom-0">
      <div class="max-w-6xl mx-auto px-3">
        <div class="animate-pop rounded-t-4xl border border-white/10 bg-[#0b1220] shadow-soft overflow-hidden">
          <div class="p-4 border-b border-white/10 flex items-center justify-between">
            <div class="font-extrabold">UloÅ¾enÃ©</div>
            <button id="savedClose" class="focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">ZavÅ™Ã­t</button>
          </div>

          <div class="p-4 md:p-5">
            <div class="flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
              <div class="text-sm text-white/70">UklÃ¡dÃ¡Å¡ si nabÃ­dky do kolekcÃ­ jako na Instagramu.</div>
              <div class="flex gap-2">
                <button id="btnNewCollection" class="focus-ring h-11 px-5 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">+ Kolekce</button>
                <button id="btnExport" class="focus-ring h-11 px-5 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">Export</button>
              </div>
            </div>

            <div class="mt-4 grid lg:grid-cols-[320px_1fr] gap-4">
              <div class="rounded-3xl border border-white/10 bg-white/5 p-4">
                <div class="text-sm font-semibold">Kolekce</div>
                <div id="collectionsList" class="mt-3 grid gap-2"></div>
              </div>

              <div class="rounded-3xl border border-white/10 bg-white/5 p-4">
                <div class="flex items-center justify-between">
                  <div class="text-sm font-semibold">Obsah</div>
                  <div class="text-xs text-white/60">Klikni pro otevÅ™enÃ­ detailu</div>
                </div>
                <div id="savedGrid" class="mt-3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
                <div id="savedEmpty" class="hidden mt-5 text-sm text-white/60">ZatÃ­m nic uloÅ¾enÃ©ho.</div>
              </div>
            </div>
          </div>

          <div class="p-4 border-t border-white/10 text-xs text-white/60">
            Tip: UloÅ¾enÃ© drÅ¾Ã­me v prohlÃ­Å¾eÄi (localStorage). NapojenÃ­ na ÃºÄet udÄ›lÃ¡me pozdÄ›ji.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============== DETAIL OVERLAY (REELS-LIKE) ============== -->
  <div id="detailModal" class="hidden fixed inset-0 z-50">
    <div id="detailBackdrop" class="absolute inset-0 bg-black/70"></div>
    <div class="absolute inset-0">
      <div class="max-w-6xl mx-auto h-full px-3 py-3 md:py-6">
        <div class="h-full rounded-4xl overflow-hidden border border-white/10 shadow-soft bg-[#050812]">
          <div class="h-full grid lg:grid-cols-[1.35fr_1fr]">

            <!-- Media -->
            <div class="relative bg-black">
              <img id="dImg" alt="" class="w-full h-full object-cover" />
              <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/15 to-black/30"></div>

              <div class="absolute top-3 left-3 right-3 flex items-center justify-between gap-2">
                <button id="detailClose" class="focus-ring h-10 px-4 rounded-2xl bg-white/10 border border-white/15 hover:bg-white/15">ZavÅ™Ã­t</button>
                <div class="flex items-center gap-2">
                  <button id="btnPrev" class="focus-ring h-10 px-4 rounded-2xl bg-white/10 border border-white/15 hover:bg-white/15">â†</button>
                  <button id="btnNext" class="focus-ring h-10 px-4 rounded-2xl bg-white/10 border border-white/15 hover:bg-white/15">â†’</button>
                </div>
              </div>

              <div class="absolute bottom-4 left-4 right-4">
                <div class="flex flex-wrap items-center gap-2">
                  <span id="dBadge" class="inline-flex items-center gap-2 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">ğŸ·ï¸ Sleva</span>
                  <span id="dEnd" class="inline-flex items-center gap-2 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">â³ KonÄÃ­</span>
                  <span id="dTag" class="inline-flex items-center gap-2 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">#</span>
                </div>
                <div class="mt-2 text-2xl md:text-3xl font-extrabold" id="dTitle">â€”</div>
                <div class="mt-1 text-sm text-white/75" id="dSubtitle">â€”</div>
              </div>
            </div>

            <!-- Content -->
            <div class="p-4 md:p-6 overflow-y-auto">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <div class="text-xs text-white/60" id="dSource">â€”</div>
                  <div class="mt-1 text-sm text-white/75" id="dMeta">â€”</div>
                </div>
                <div class="flex items-center gap-2">
                  <button id="dSave" class="focus-ring h-11 px-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">ğŸ’¾ UloÅ¾it</button>
                  <button id="dShare" class="focus-ring h-11 px-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">ğŸ” SdÃ­let</button>
                </div>
              </div>

              <div class="mt-4 rounded-3xl border border-white/10 bg-white/5 p-4">
                <div class="text-sm font-semibold">PÅ™Ã­bÄ›h</div>
                <p class="mt-2 text-sm text-white/75 leading-relaxed" id="dStory">â€”</p>
              </div>

              <div class="mt-4 grid grid-cols-2 gap-3">
                <div class="rounded-3xl border border-white/10 bg-white/5 p-4">
                  <div class="text-xs text-white/60">PÅ¯vodnÃ­ cena</div>
                  <div class="mt-1 text-lg font-extrabold" id="dOld">â€”</div>
                </div>
                <div class="rounded-3xl border border-white/10 bg-white/5 p-4">
                  <div class="text-xs text-white/60">Cena se slevou</div>
                  <div class="mt-1 text-lg font-extrabold" id="dNew">â€”</div>
                </div>
              </div>

              <div class="mt-4 rounded-3xl border border-white/10 bg-gradient-to-br from-emerald-500/15 to-sky-500/10 p-[1px]">
                <div class="rounded-3xl bg-[#0b1220] p-4">
                  <div class="flex items-center justify-between gap-3">
                    <div>
                      <div class="text-sm font-semibold">PÅ™ipraveno</div>
                      <div class="text-xs text-white/60">KlikneÅ¡ a bereÅ¡. V MVP je to jen demo link.</div>
                    </div>
                    <a id="dCta" href="#" target="_blank" rel="noopener" class="focus-ring inline-flex items-center justify-center h-12 px-5 rounded-2xl bg-gradient-to-br from-fuchsia-500/25 via-neutral-900 to-amber-500/15 border border-white/10 hover:opacity-95">
                      VzÃ­t se slevou
                    </a>
                  </div>
                </div>
              </div>

              <div class="mt-5 text-xs text-white/55">
                OvlÃ¡dÃ¡nÃ­: Å¡ipky â† â†’, ESC zavÅ™e, Enter otevÅ™e â€VzÃ­t se slevouâ€œ.
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============== TOAST ============== -->
  <div id="toast" class="hidden fixed left-1/2 -translate-x-1/2 bottom-20 md:bottom-6 z-[60]">
    <div class="rounded-2xl border border-white/10 bg-[#0b1220] shadow-soft px-4 py-3 text-sm"></div>
  </div>

<script>
  /*******************************************************************
   * SLEVAO MVP â€“ VÅ¡e v jednom souboru (start)
   * - feed karet (instagram styl)
   * - detail overlay (reels)
   * - filtry + Å™azenÃ­
   * - uklÃ¡dÃ¡nÃ­ do kolekcÃ­ (localStorage)
   *******************************************************************/

  // ====== UTIL ======
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
  const fmtCZK = (n) => new Intl.NumberFormat('cs-CZ').format(Math.round(Number(n)||0)) + ' KÄ';
  const clamp = (n,min,max)=>Math.min(max,Math.max(min,n));
  const uid = () => Math.random().toString(16).slice(2) + Date.now().toString(16);
  const today = () => new Date();
  const addDays = (d, days)=> new Date(d.getTime() + days*24*60*60*1000);
  const daysBetween = (a,b)=> Math.ceil((b.getTime()-a.getTime())/(24*60*60*1000));
  const safeJson = (v, fallback) => { try{ return JSON.parse(v); }catch(e){ return fallback; } };

  // ====== STORAGE KEYS ======
  const KEY_SAVED = 'slevao_saved_v1';
  const KEY_COLLECTIONS = 'slevao_collections_v1';
  const KEY_STATE = 'slevao_state_v1';

  // ====== DEMO DATA ======
  // Pozn.: fotky jsou z veÅ™ejnÃ½ch zdrojÅ¯ (Unsplash). PozdÄ›ji nahradÃ­me vlastnÃ­.
  const DEMO = [
    {
      id: 'food-001',
      cat: 'food',
      title: 'Burger s trhanÃ½m hovÄ›zÃ­m + hranolky',
      subtitle: 'Å Å¥avnatÃ½, kouÅ™ovÃ½, omÃ¡Äka co dÄ›lÃ¡ problÃ©m.',
      story: 'KdyÅ¾ se do toho zakousneÅ¡, pochopÃ­Å¡. Dneska to jede rychle â€“ limitovanÃ¡ vÃ¡rka, protoÅ¾e maso se trhÃ¡ pomalu. IdeÃ¡lnÃ­ ve dvou: burger + hranolky + dip. A pak uÅ¾ jenâ€¦ dalÅ¡Ã­ kolo.',
      img: 'https://images.unsplash.com/photo-1550547660-d9450f859349?auto=format&fit=crop&w=1600&q=80',
      source: 'GURMAO',
      discount: 25,
      oldPrice: 319,
      newPrice: 239,
      expiresInDays: 0,
      tags: ['burger','fastfood','brno','top'],
      link: 'https://example.com'
    },
    {
      id: 'food-002',
      cat: 'food',
      title: 'Steak & vÃ­no veÄer pro dva',
      subtitle: 'Medium rare + ÄervenÃ©, co vonÃ­ po tÅ™eÅ¡nÃ­ch.',
      story: 'DvÄ› Å¾idle, dvÄ› sklenky, jeden plÃ¡n. Slevu ber jako omluvu, Å¾e jsi tam jeÅ¡tÄ› nebyl. Rezervace se rychle plnÃ­.',
      img: 'https://images.unsplash.com/photo-1551183053-bf91a1d81141?auto=format&fit=crop&w=1600&q=80',
      source: 'GURMAO',
      discount: 35,
      oldPrice: 1290,
      newPrice: 839,
      expiresInDays: 3,
      tags: ['steak','vino','vecer','romantika'],
      link: 'https://example.com'
    },
    {
      id: 'stay-001',
      cat: 'stay',
      title: 'Chata v lese + vÃ­Å™ivka + krb',
      subtitle: 'Ticho. DÅ™evo praskÃ¡. Telefon vypni.',
      story: 'PÅ™ijedeÅ¡, hodÃ­Å¡ vÄ›ci, zapÃ¡lÃ­Å¡ v krbu a pÅ™estaneÅ¡ Å™eÅ¡it svÄ›t. VÃ­Å™ivka venku, hvÄ›zdy nad hlavou. Tahle sleva je jen na pÃ¡r termÃ­nÅ¯.',
      img: 'https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?auto=format&fit=crop&w=1600&q=80',
      source: 'CHATAO',
      discount: 40,
      oldPrice: 3990,
      newPrice: 2390,
      expiresInDays: 2,
      tags: ['virivka','krb','les','vikend'],
      link: 'https://example.com'
    },
    {
      id: 'stay-002',
      cat: 'stay',
      title: 'Glamping u jezera â€“ stan jak hotel',
      subtitle: 'RÃ¡no mlha, veÄer oheÅˆ.',
      story: 'NechceÅ¡ â€ubytovÃ¡nÃ­â€œ. ChceÅ¡ zÃ¡Å¾itek. RannÃ­ kafe u vody a veÄer pod dekou. IdeÃ¡lnÃ­ na reset hlavy.',
      img: 'https://images.unsplash.com/photo-1523987355523-c7b5b84f0f5c?auto=format&fit=crop&w=1600&q=80',
      source: 'CHATAO',
      discount: 30,
      oldPrice: 2590,
      newPrice: 1790,
      expiresInDays: 7,
      tags: ['glamping','jezero','priroda','klid'],
      link: 'https://example.com'
    },
    {
      id: 'shop-001',
      cat: 'shop',
      title: 'MinimalistickÃ© hodinky (ocel)',
      subtitle: 'ÄŒistÃ½ design. VypadÃ¡ draÅ¾Å¡Ã­, neÅ¾ je.',
      story: 'KdyÅ¾ chceÅ¡ nÄ›co, co nevypadÃ¡ levnÄ›, ale taky nechceÅ¡ vyhodit vÃ½platu. Tohle sedÃ­ ke vÅ¡emu. A teÄ jeÅ¡tÄ› levnÄ›ji.',
      img: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?auto=format&fit=crop&w=1600&q=80',
      source: 'SLEVAO',
      discount: 45,
      oldPrice: 1990,
      newPrice: 1090,
      expiresInDays: 10,
      tags: ['hodinky','design','dark','gift'],
      link: 'https://example.com'
    },
    {
      id: 'shop-002',
      cat: 'shop',
      title: 'PrÃ©miovÃ½ dÃ¡rkovÃ½ box â€“ ÄokolÃ¡dy & kÃ¡va',
      subtitle: 'DÃ¡rek, co vypadÃ¡ jako â€wowâ€œ bez stresu.',
      story: 'ChceÅ¡ nÄ›co, co udÄ›lÃ¡ radost okamÅ¾itÄ›. Bez velikostÃ­, bez vracenÃ­. Box je zabalenÃ½, pÅ™ipravenÃ½, jen pÅ™edat.',
      img: 'https://images.unsplash.com/photo-1514846326710-096e3f0c1b1a?auto=format&fit=crop&w=1600&q=80',
      source: 'SLEVAO',
      discount: 20,
      oldPrice: 890,
      newPrice: 712,
      expiresInDays: 1,
      tags: ['box','darky','kava','cokolada'],
      link: 'https://example.com'
    },
    {
      id: 'food-003',
      cat: 'food',
      title: 'SnÃ­danÄ›: vejce Benedikt + cappuccino',
      subtitle: 'RÃ¡no, co tÄ› postavÃ­ na nohy.',
      story: 'LehkÃ¡, ale sytÃ¡. HolandskÃ¡ omÃ¡Äka, kterÃ¡ je pÅ™esnÄ› akorÃ¡t. A k tomu kafe, co vonÃ­ uÅ¾ z dÃ¡lky.',
      img: 'https://images.unsplash.com/photo-1551024709-8f23befc6f87?auto=format&fit=crop&w=1600&q=80',
      source: 'GURMAO',
      discount: 15,
      oldPrice: 289,
      newPrice: 245,
      expiresInDays: 5,
      tags: ['snidane','kava','brunch','top'],
      link: 'https://example.com'
    },
    {
      id: 'stay-003',
      cat: 'stay',
      title: 'Wellness vÃ­kend v horÃ¡ch',
      subtitle: 'Sauna, bazÃ©n, vÃ½hled.',
      story: 'Ten typ vÃ­kendu, kdy se vrÃ¡tÃ­Å¡ domÅ¯ a jsi lehÄÃ­ o 10 kg stresu. TermÃ­ny mizÃ­, protoÅ¾e tohle chce kaÅ¾dÃ½.',
      img: 'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?auto=format&fit=crop&w=1600&q=80',
      source: 'CHATAO',
      discount: 50,
      oldPrice: 5990,
      newPrice: 2990,
      expiresInDays: 0,
      tags: ['wellness','hory','sauna','vikend'],
      link: 'https://example.com'
    }
  ];

  // ====== STATE ======
  const state = {
    cat: 'all',
    q: '',
    minDisc: 0,
    exp: 'all',
    priceMin: '',
    priceMax: '',
    tags: [],
    sort: 'relevance',
    hotOnly: false,
    activeCollection: 'VÅ¡e',
    detailIndex: 0,
  };

  // ====== SAVED MODEL ======
  // saved: { [offerId]: { offerId, collections: [name], savedAt } }
  function loadSaved(){
    return safeJson(localStorage.getItem(KEY_SAVED), {});
  }
  function saveSaved(obj){
    localStorage.setItem(KEY_SAVED, JSON.stringify(obj));
  }
  function loadCollections(){
    const base = ['VÅ¡e','Chci jÃ­st','Chci jet pryÄ','Chci koupit'];
    const fromStore = safeJson(localStorage.getItem(KEY_COLLECTIONS), null);
    if(!fromStore) return base;
    // merge
    const merged = [...new Set([...base, ...fromStore])];
    return merged;
  }
  function saveCollections(arr){
    localStorage.setItem(KEY_COLLECTIONS, JSON.stringify([...new Set(arr)]));
  }

  // ====== PERSIST STATE ======
  function loadState(){
    const s = safeJson(localStorage.getItem(KEY_STATE), null);
    if(s && typeof s === 'object') Object.assign(state, s);
  }
  function persistState(){
    localStorage.setItem(KEY_STATE, JSON.stringify(state));
  }

  // ====== UI ELEMENTS ======
  const el = {
    feed: $('#feed'),
    empty: $('#empty'),
    q: $('#q'),
    metaLine: $('#metaLine'),
    savedCount: $('#savedCount'),
    year: $('#year'),

    // stats
    statAll: $('#statAll'),
    statHot: $('#statHot'),
    statSaved: $('#statSaved'),

    // modals
    filtersModal: $('#filtersModal'),
    filtersBackdrop: $('#filtersBackdrop'),
    filtersClose: $('#filtersClose'),
    filtersMeta: $('#filtersMeta'),
    tagsBox: $('#tagsBox'),
    priceMin: $('#priceMin'),
    priceMax: $('#priceMax'),

    sortModal: $('#sortModal'),
    sortBackdrop: $('#sortBackdrop'),
    sortClose: $('#sortClose'),

    savedModal: $('#savedModal'),
    savedBackdrop: $('#savedBackdrop'),
    savedClose: $('#savedClose'),
    collectionsList: $('#collectionsList'),
    savedGrid: $('#savedGrid'),
    savedEmpty: $('#savedEmpty'),

    detailModal: $('#detailModal'),
    detailBackdrop: $('#detailBackdrop'),
    detailClose: $('#detailClose'),
    btnPrev: $('#btnPrev'),
    btnNext: $('#btnNext'),
    dImg: $('#dImg'),
    dBadge: $('#dBadge'),
    dEnd: $('#dEnd'),
    dTag: $('#dTag'),
    dTitle: $('#dTitle'),
    dSubtitle: $('#dSubtitle'),
    dSource: $('#dSource'),
    dMeta: $('#dMeta'),
    dStory: $('#dStory'),
    dOld: $('#dOld'),
    dNew: $('#dNew'),
    dCta: $('#dCta'),
    dSave: $('#dSave'),
    dShare: $('#dShare'),

    toast: $('#toast'),
  };

  // ====== TAGS ======
  function computeAllTags(items){
    const set = new Set();
    items.forEach(o => (o.tags||[]).forEach(t => set.add(t)));
    return Array.from(set).sort((a,b)=>a.localeCompare(b,'cs'));
  }

  // ====== RENDER HELPERS ======
  function badgeCat(cat){
    if(cat==='food') return 'GURMAO Â· JÃ­dlo';
    if(cat==='stay') return 'CHATAO Â· Pobyt';
    return 'SLEVAO Â· Produkty';
  }

  function catEmoji(cat){
    if(cat==='food') return 'ğŸ”';
    if(cat==='stay') return 'ğŸ•ï¸';
    return 'ğŸ›ï¸';
  }

  function expLabel(expiresInDays){
    if(expiresInDays === 0) return 'KonÄÃ­ dnes';
    if(expiresInDays === 1) return 'KonÄÃ­ zÃ­tra';
    if(expiresInDays <= 7) return `KonÄÃ­ za ${expiresInDays} dny`;
    return `PlatÃ­ jeÅ¡tÄ› ${expiresInDays} dnÃ­`;
  }

  function isHot(o){
    return (o.expiresInDays<=1) || (o.discount>=40) || (o.tags||[]).includes('top');
  }

  function tagPill(t, active){
    const base = "inline-flex items-center gap-1 px-3 py-2 rounded-2xl border text-xs hover:bg-white/10";
    const cls = active ? "bg-white/12 border-white/20" : "bg-white/5 border-white/10";
    return `<button class="tagBtn ${base} ${cls}" data-tag="${t}">#${t}</button>`;
  }

  function pillBtn(label, active){
    return `<button class="pillBtn focus-ring h-11 rounded-2xl border px-4 text-sm ${active? 'bg-white/12 border-white/20':'bg-white/5 border-white/10 hover:bg-white/10'}">${label}</button>`;
  }

  function toast(msg){
    const box = el.toast.firstElementChild;
    box.textContent = msg;
    el.toast.classList.remove('hidden');
    setTimeout(()=> el.toast.classList.add('hidden'), 2200);
  }

  function openModal(modal){
    modal.classList.remove('hidden');
    document.body.classList.add('modal-open');
  }
  function closeModal(modal){
    modal.classList.add('hidden');
    // kdyÅ¾ nenÃ­ otevÅ™enÃ½ Å¾Ã¡dnÃ½ dalÅ¡Ã­
    const anyOpen = [el.filtersModal, el.sortModal, el.savedModal, el.detailModal].some(m => !m.classList.contains('hidden'));
    if(!anyOpen) document.body.classList.remove('modal-open');
  }

  // ====== FILTERS ======
  function passFilters(o){
    // category
    if(state.cat !== 'all' && o.cat !== state.cat) return false;

    // hot only
    if(state.hotOnly && !isHot(o)) return false;

    // query
    const q = (state.q||'').trim().toLowerCase();
    if(q){
      const hay = `${o.title} ${o.subtitle} ${(o.tags||[]).join(' ')} ${o.source}`.toLowerCase();
      if(!hay.includes(q)) return false;
    }

    // min discount
    if(Number(state.minDisc||0) > 0){
      const d = Number(o.discount||0);
      if(d < Number(state.minDisc)) return false;
    }

    // expiry
    if(state.exp && state.exp !== 'all'){
      const d = Number(o.expiresInDays||999);
      if(state.exp === 'today' && d !== 0) return false;
      if(state.exp === 'week' && d > 7) return false;
      if(state.exp === 'long' && d <= 7) return false;
    }

    // price
    const pMin = state.priceMin === '' ? null : Number(state.priceMin);
    const pMax = state.priceMax === '' ? null : Number(state.priceMax);
    const p = Number(o.newPrice||0);
    if(pMin !== null && !Number.isNaN(pMin) && p < pMin) return false;
    if(pMax !== null && !Number.isNaN(pMax) && p > pMax) return false;

    // tags (AND)
    if(state.tags && state.tags.length){
      const set = new Set(o.tags||[]);
      for(const t of state.tags){
        if(!set.has(t)) return false;
      }
    }

    return true;
  }

  function sortItems(items){
    const s = state.sort || 'relevance';
    const arr = [...items];

    if(s === 'discount'){
      arr.sort((a,b)=> (b.discount||0) - (a.discount||0));
      return arr;
    }
    if(s === 'priceLow'){
      arr.sort((a,b)=> (a.newPrice||0) - (b.newPrice||0));
      return arr;
    }
    if(s === 'ending'){
      arr.sort((a,b)=> (a.expiresInDays||999) - (b.expiresInDays||999));
      return arr;
    }

    // relevance (mix: hot first, then discount, then ending)
    arr.sort((a,b)=>{
      const ah = isHot(a) ? 1 : 0;
      const bh = isHot(b) ? 1 : 0;
      if(bh !== ah) return bh - ah;
      const dd = (b.discount||0) - (a.discount||0);
      if(dd !== 0) return dd;
      return (a.expiresInDays||999) - (b.expiresInDays||999);
    });
    return arr;
  }

  // ====== CARD TEMPLATE ======
  function cardHTML(o){
    const hot = isHot(o);
    const exp = expLabel(o.expiresInDays);
    const saved = !!loadSaved()[o.id];

    const tagOne = (o.tags && o.tags[0]) ? o.tags[0] : '';

    return `
      <article class="group relative overflow-hidden rounded-4xl border border-white/10 bg-white/5 shadow-soft hover:shadow-glow transition" data-id="${o.id}">
        <div class="relative aspect-[4/5] bg-black">
          <img alt="${escapeHtml(o.title)}" src="${o.img}" class="w-full h-full object-cover group-hover:scale-[1.02] transition duration-500" loading="lazy" />
          <div class="absolute inset-0 bg-gradient-to-t from-black/75 via-black/10 to-black/35"></div>

          <div class="absolute top-3 left-3 right-3 flex items-center justify-between gap-2">
            <div class="inline-flex items-center gap-2 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">
              <span>${catEmoji(o.cat)}</span>
              <span class="text-white/80">${badgeCat(o.cat)}</span>
            </div>
            <button class="saveBtn focus-ring h-10 px-3 rounded-2xl border ${saved?'bg-white/15 border-white/20':'bg-white/10 border-white/15 hover:bg-white/15'}" title="UloÅ¾it" data-save="${o.id}">
              ${saved ? 'ğŸ’¾' : 'ğŸ¤'}
            </button>
          </div>

          <div class="absolute bottom-3 left-3 right-3">
            <div class="flex flex-wrap items-center gap-2">
              <span class="inline-flex items-center gap-1 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">
                ğŸ·ï¸ <b class="font-extrabold">-${o.discount || 0}%</b>
              </span>
              <span class="inline-flex items-center gap-1 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">
                â³ ${exp}
              </span>
              ${hot ? `<span class="inline-flex items-center gap-1 text-xs px-3 py-1 rounded-full border border-white/15 bg-gradient-to-br from-fuchsia-500/20 to-amber-500/10">ğŸ”¥ Hot</span>` : ''}
              ${tagOne ? `<span class="inline-flex items-center gap-1 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">#${escapeHtml(tagOne)}</span>` : ''}
            </div>
            <div class="mt-2 text-lg font-extrabold leading-tight">${escapeHtml(o.title)}</div>
            <div class="mt-1 text-sm text-white/75 clamp-2">${escapeHtml(o.subtitle||'')}</div>

            <div class="mt-3 flex items-center justify-between">
              <div class="text-sm">
                <span class="line-through text-white/40">${fmtCZK(o.oldPrice)}</span>
                <span class="ml-2 font-extrabold">${fmtCZK(o.newPrice)}</span>
              </div>
              <button class="openBtn focus-ring h-10 px-4 rounded-2xl bg-white/10 border border-white/15 hover:bg-white/15" data-open="${o.id}">Detail</button>
            </div>
          </div>
        </div>
      </article>
    `;
  }

  function escapeHtml(str){
    return String(str||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
  }

  // ====== RENDER FEED ======
  let filtered = [];

  function render(){
    persistState();

    const items = DEMO.filter(passFilters);
    const out = sortItems(items);
    filtered = out;

    el.feed.innerHTML = out.map(cardHTML).join('');

    const isEmpty = out.length === 0;
    el.empty.classList.toggle('hidden', !isEmpty);

    // meta
    const hotCount = DEMO.filter(isHot).length;
    el.metaLine.textContent = `${out.length} vÃ½sledkÅ¯ Â· ${badgeCat(state.cat==='all'?'shop':state.cat).replace('SLEVAO Â· Produkty','VÅ¡e')} Â· Å™azenÃ­: ${sortLabel(state.sort)}${state.hotOnly? ' Â· jen hot':''}`;

    // counters
    const saved = loadSaved();
    const savedN = Object.keys(saved).length;
    el.savedCount.textContent = String(savedN);
    el.statAll.textContent = String(DEMO.length);
    el.statHot.textContent = String(hotCount);
    el.statSaved.textContent = String(savedN);

    // bind buttons
    bindCardButtons();

    // filters meta
    el.filtersMeta.textContent = describeFilters();
  }

  function sortLabel(s){
    if(s==='discount') return 'sleva';
    if(s==='priceLow') return 'cena';
    if(s==='ending') return 'konÄÃ­';
    return 'doporuÄenÃ©';
  }

  function describeFilters(){
    const parts = [];
    if(state.cat !== 'all') parts.push(badgeCat(state.cat));
    if((state.q||'').trim()) parts.push(`"${(state.q||'').trim()}"`);
    if(Number(state.minDisc||0) > 0) parts.push(`${state.minDisc}%+`);
    if(state.exp && state.exp !== 'all') parts.push({today:'konÄÃ­ dnes',week:'do 7 dnÃ­',long:'dlouhodobÃ©'}[state.exp] || state.exp);
    if(state.priceMin !== '' || state.priceMax !== '') parts.push(`cena ${state.priceMin||0}â€“${state.priceMax||'âˆ'} KÄ`);
    if(state.tags && state.tags.length) parts.push(`#${state.tags.join(' #')}`);
    if(state.hotOnly) parts.push('jen hot');
    if(!parts.length) return 'Å¾Ã¡dnÃ©';
    return parts.join(' Â· ');
  }

  function bindCardButtons(){
    // open detail
    $$('.openBtn').forEach(btn => {
      btn.addEventListener('click', (e)=>{
        e.stopPropagation();
        const id = btn.getAttribute('data-open');
        openDetailById(id);
      });
    });

    // click whole card opens detail
    $$('#feed article').forEach(card => {
      card.addEventListener('click', (e)=>{
        if(e.target.closest('.saveBtn') || e.target.closest('.openBtn')) return;
        openDetailById(card.getAttribute('data-id'));
      });
    });

    // save
    $$('.saveBtn').forEach(btn => {
      btn.addEventListener('click', (e)=>{
        e.stopPropagation();
        const id = btn.getAttribute('data-save');
        quickToggleSave(id);
      });
    });
  }

  // ====== SAVING ======
  function quickToggleSave(offerId){
    const saved = loadSaved();
    const exists = !!saved[offerId];

    if(exists){
      delete saved[offerId];
      saveSaved(saved);
      toast('OdebrÃ¡no z uloÅ¾enÃ½ch');
    }else{
      saved[offerId] = { offerId, collections: ['VÅ¡e'], savedAt: Date.now() };
      saveSaved(saved);
      toast('UloÅ¾eno');
    }
    render();
  }

  function ensureSaved(offerId){
    const saved = loadSaved();
    if(!saved[offerId]){
      saved[offerId] = { offerId, collections: ['VÅ¡e'], savedAt: Date.now() };
      saveSaved(saved);
    }
  }

  function setOfferCollections(offerId, cols){
    const saved = loadSaved();
    ensureSaved(offerId);
    saved[offerId].collections = [...new Set(cols)];
    saveSaved(saved);
    renderSavedModal();
    render();
  }

  // ====== DETAIL ======
  function openDetailById(id){
    const idx = filtered.findIndex(x => x.id === id);
    if(idx < 0) return;
    state.detailIndex = idx;
    persistState();
    renderDetail();
    openModal(el.detailModal);
  }

  function renderDetail(){
    const o = filtered[state.detailIndex];
    if(!o) return;

    el.dImg.src = o.img;
    el.dTitle.textContent = o.title;
    el.dSubtitle.textContent = o.subtitle || '';
    el.dSource.textContent = `${o.source} Â· ${badgeCat(o.cat)}`;

    const exp = expLabel(o.expiresInDays);
    el.dEnd.textContent = `â³ ${exp}`;
    el.dBadge.innerHTML = `ğŸ·ï¸ <b class="font-extrabold">-${o.discount||0}%</b>`;
    el.dTag.textContent = `#${(o.tags && o.tags[0]) ? o.tags[0] : 'sleva'}`;

    el.dStory.textContent = o.story || '';
    el.dOld.textContent = fmtCZK(o.oldPrice);
    el.dNew.textContent = fmtCZK(o.newPrice);

    el.dMeta.textContent = `UÅ¡etÅ™Ã­Å¡ ${fmtCZK((o.oldPrice||0) - (o.newPrice||0))} Â· ${Math.round(((o.discount||0))) }% sleva`;

    el.dCta.href = o.link || '#';

    const saved = loadSaved();
    const isS = !!saved[o.id];
    el.dSave.textContent = isS ? 'ğŸ’¾ UloÅ¾eno' : 'ğŸ’¾ UloÅ¾it';
  }

  // ====== SAVED MODAL ======
  function openSaved(){
    renderSavedModal();
    openModal(el.savedModal);
  }

  function renderSavedModal(){
    const saved = loadSaved();
    const ids = Object.keys(saved);
    const cols = loadCollections();

    // collections list
    el.collectionsList.innerHTML = cols.map(name => {
      const active = state.activeCollection === name;
      return `
        <button class="colBtn focus-ring h-11 px-4 rounded-2xl border text-sm text-left ${active? 'bg-white/12 border-white/20':'bg-white/5 border-white/10 hover:bg-white/10'}" data-col="${escapeHtml(name)}">
          <div class="flex items-center justify-between">
            <span>${escapeHtml(name)}</span>
            <span class="text-xs text-white/60">${countInCollection(name, saved)}</span>
          </div>
        </button>
      `;
    }).join('');

    // bind collection buttons
    $$('.colBtn', el.collectionsList).forEach(b => {
      b.addEventListener('click', ()=>{
        state.activeCollection = b.getAttribute('data-col');
        persistState();
        renderSavedModal();
      });
    });

    // saved grid filtered by activeCollection
    const active = state.activeCollection || 'VÅ¡e';
    const shown = DEMO.filter(o => {
      const rec = saved[o.id];
      if(!rec) return false;
      if(active === 'VÅ¡e') return true;
      return (rec.collections||[]).includes(active);
    });

    el.savedGrid.innerHTML = shown.map(o => {
      return `
        <button class="savedItem group text-left rounded-3xl border border-white/10 bg-white/5 overflow-hidden hover:bg-white/10" data-open="${o.id}">
          <div class="aspect-[4/3] bg-black relative">
            <img src="${o.img}" alt="" class="w-full h-full object-cover group-hover:scale-[1.02] transition" loading="lazy" />
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/10 to-black/30"></div>
            <div class="absolute bottom-2 left-2 right-2 flex items-center justify-between">
              <span class="text-xs px-2 py-1 rounded-full border border-white/15 bg-white/10">-${o.discount||0}%</span>
              <span class="text-xs px-2 py-1 rounded-full border border-white/15 bg-white/10">${catEmoji(o.cat)}</span>
            </div>
          </div>
          <div class="p-3">
            <div class="font-extrabold text-sm leading-tight clamp-2">${escapeHtml(o.title)}</div>
            <div class="mt-1 text-xs text-white/65">${fmtCZK(o.newPrice)}</div>
            <div class="mt-2 flex flex-wrap gap-1">
              ${(saved[o.id]?.collections||[]).slice(0,3).map(c=>`<span class="text-[10px] px-2 py-0.5 rounded-full bg-white/7 border border-white/10">${escapeHtml(c)}</span>`).join('')}
            </div>
          </div>
        </button>
      `;
    }).join('');

    el.savedEmpty.classList.toggle('hidden', shown.length !== 0);

    $$('.savedItem', el.savedGrid).forEach(b => {
      b.addEventListener('click', ()=>{
        closeModal(el.savedModal);
        openDetailById(b.getAttribute('data-open'));
      });
    });
  }

  function countInCollection(col, saved){
    if(col === 'VÅ¡e') return Object.keys(saved).length;
    let n = 0;
    for(const k of Object.keys(saved)){
      const rec = saved[k];
      if((rec.collections||[]).includes(col)) n++;
    }
    return n;
  }

  // ====== FILTERS UI ======
  function renderTagsBox(){
    const tags = computeAllTags(DEMO);
    el.tagsBox.innerHTML = tags.map(t => tagPill(t, state.tags.includes(t))).join('');
    $$('.tagBtn', el.tagsBox).forEach(btn => {
      btn.addEventListener('click', ()=>{
        const t = btn.getAttribute('data-tag');
        const i = state.tags.indexOf(t);
        if(i >= 0) state.tags.splice(i,1); else state.tags.push(t);
        renderTagsBox();
        el.filtersMeta.textContent = describeFilters();
      });
    });
  }

  function applyFiltersFromSheet(){
    const a = document.activeElement;
    if(a) a.blur();
    state.priceMin = (el.priceMin.value||'').trim();
    state.priceMax = (el.priceMax.value||'').trim();
    closeModal(el.filtersModal);
    render();
    toast('Filtry pouÅ¾ity');
  }

  // ====== SORT UI ======
  function openSort(){
    openModal(el.sortModal);
  }

  // ====== INIT BINDINGS ======
  function bindTop(){
    // category buttons
    $$('.catBtn').forEach(b => {
      b.addEventListener('click', ()=>{
        state.cat = b.getAttribute('data-cat');
        // vizuÃ¡lnÃ­ active
        $$('.catBtn').forEach(x => x.classList.remove('bg-white/12','border-white/20'));
        b.classList.add('bg-white/12','border-white/20');
        render();
      });
    });

    // search
    el.q.addEventListener('input', ()=>{
      state.q = el.q.value;
      render();
    });

    // filters
    $('#btnFilters').addEventListener('click', ()=>{
      // naplnit sheet hodnoty
      el.priceMin.value = state.priceMin;
      el.priceMax.value = state.priceMax;
      renderTagsBox();
      el.filtersMeta.textContent = describeFilters();
      openModal(el.filtersModal);
    });
    el.filtersBackdrop.addEventListener('click', ()=> closeModal(el.filtersModal));
    el.filtersClose.addEventListener('click', ()=> closeModal(el.filtersModal));
    $('#btnApplyFilters').addEventListener('click', applyFiltersFromSheet);
    $('#btnClearFilters').addEventListener('click', ()=>{
      state.minDisc = 0;
      state.exp = 'all';
      state.priceMin = '';
      state.priceMax = '';
      state.tags = [];
      state.hotOnly = false;
      el.priceMin.value = '';
      el.priceMax.value = '';
      renderTagsBox();
      el.filtersMeta.textContent = describeFilters();
      render();
      toast('Filtry vymazÃ¡ny');
    });

    // pills (discount)
    $$('.pill[data-disc]').forEach(p => {
      stylePill(p, Number(p.getAttribute('data-disc')) === Number(state.minDisc));
      p.addEventListener('click', ()=>{
        const v = Number(p.getAttribute('data-disc'));
        state.minDisc = v;
        $$('.pill[data-disc]').forEach(x => stylePill(x, Number(x.getAttribute('data-disc')) === v));
        el.filtersMeta.textContent = describeFilters();
      });
    });

    // pills (exp)
    $$('.pill[data-exp]').forEach(p => {
      stylePill(p, p.getAttribute('data-exp') === state.exp);
      p.addEventListener('click', ()=>{
        const v = p.getAttribute('data-exp');
        state.exp = v;
        $$('.pill[data-exp]').forEach(x => stylePill(x, x.getAttribute('data-exp') === v));
        el.filtersMeta.textContent = describeFilters();
      });
    });

    // sort
    $('#btnSort').addEventListener('click', openSort);
    el.sortBackdrop.addEventListener('click', ()=> closeModal(el.sortModal));
    el.sortClose.addEventListener('click', ()=> closeModal(el.sortModal));
    $$('.sortOpt').forEach(btn => {
      btn.addEventListener('click', ()=>{
        state.sort = btn.getAttribute('data-sort');
        closeModal(el.sortModal);
        render();
        toast('Å˜azenÃ­ zmÄ›nÄ›no');
      });
    });

    // random
    $('#btnRandom').addEventListener('click', ()=>{
      const idx = Math.floor(Math.random()*filtered.length);
      state.detailIndex = clamp(idx,0,Math.max(0,filtered.length-1));
      persistState();
      renderDetail();
      openModal(el.detailModal);
    });

    // hot
    $('#btnHot').addEventListener('click', ()=>{
      state.hotOnly = !state.hotOnly;
      toast(state.hotOnly ? 'Jen hot nabÃ­dky' : 'VÅ¡echny nabÃ­dky');
      render();
    });

    // near (demo)
    $('#btnNear').addEventListener('click', ()=> toast('â€Okolo mÄ›â€œ pÅ™idÃ¡me po napojenÃ­ na mapy.'));

    // collections
    $('#btnCollections').addEventListener('click', openSaved);

    // saved
    $('#btnSaved').addEventListener('click', openSaved);

    // reset
    $('#btnReset').addEventListener('click', ()=>{
      state.cat = 'all';
      state.q = '';
      state.minDisc = 0;
      state.exp = 'all';
      state.priceMin = '';
      state.priceMax = '';
      state.tags = [];
      state.hotOnly = false;
      state.sort = 'relevance';
      el.q.value = '';
      // active tab
      $$('.catBtn').forEach(x => x.classList.remove('bg-white/12','border-white/20'));
      $$('.catBtn[data-cat="all"]').forEach(x => x.classList.add('bg-white/12','border-white/20'));
      render();
      toast('Reset hotovÃ½');
    });

    // home
    $('#btnHome').addEventListener('click', ()=>{
      window.scrollTo({ top: 0, behavior: 'smooth' });
      toast('ZpÄ›t na zaÄÃ¡tek');
    });

    // mobile nav
    $$('.navBtn').forEach(b=>{
      b.addEventListener('click', ()=>{
        const to = b.getAttribute('data-nav');
        if(to==='home') window.scrollTo({ top: 0, behavior: 'smooth' });
        if(to==='filters') $('#btnFilters').click();
        if(to==='saved') openSaved();
        if(to==='profile') toast('Profil pÅ™idÃ¡me v dalÅ¡Ã­m kroku (login).');
      });
    });

    // saved modal close
    el.savedBackdrop.addEventListener('click', ()=> closeModal(el.savedModal));
    el.savedClose.addEventListener('click', ()=> closeModal(el.savedModal));

    // new collection
    $('#btnNewCollection').addEventListener('click', ()=>{
      const name = prompt('NÃ¡zev novÃ© kolekce (napÅ™. "Brno â€“ jÃ­dlo"):');
      if(!name) return;
      const cols = loadCollections();
      cols.push(name.trim());
      saveCollections(cols);
      state.activeCollection = name.trim();
      persistState();
      renderSavedModal();
      toast('Kolekce pÅ™idÃ¡na');
    });

    // export
    $('#btnExport').addEventListener('click', ()=>{
      const saved = loadSaved();
      const ids = Object.keys(saved);
      const rows = ids.map(id => {
        const o = DEMO.find(x=>x.id===id);
        const rec = saved[id];
        return {
          id,
          title: o?.title || id,
          cat: o?.cat || '',
          discount: o?.discount || 0,
          newPrice: o?.newPrice || 0,
          collections: (rec?.collections||[]).join(', ')
        };
      });
      const json = JSON.stringify(rows, null, 2);
      navigator.clipboard?.writeText(json).then(()=> toast('Export zkopÃ­rovÃ¡n do schrÃ¡nky')).catch(()=>{
        alert(json);
      });
    });

    // detail close
    el.detailBackdrop.addEventListener('click', ()=> closeModal(el.detailModal));
    el.detailClose.addEventListener('click', ()=> closeModal(el.detailModal));

    // detail prev/next
    el.btnPrev.addEventListener('click', ()=>{
      state.detailIndex = clamp(state.detailIndex-1, 0, filtered.length-1);
      persistState();
      renderDetail();
    });
    el.btnNext.addEventListener('click', ()=>{
      state.detailIndex = clamp(state.detailIndex+1, 0, filtered.length-1);
      persistState();
      renderDetail();
    });

    // detail save
    el.dSave.addEventListener('click', ()=>{
      const o = filtered[state.detailIndex];
      if(!o) return;
      // otevÅ™ rychlÃ½ vÃ½bÄ›r kolekce
      ensureSaved(o.id);
      const saved = loadSaved();
      const rec = saved[o.id];
      const cols = loadCollections();

      // jednoduchÃ½ multi-select prompt (MVP)
      const current = (rec.collections||[]);
      const text = cols.map(c => `${current.includes(c)?'[x]':'[ ]'} ${c}`).join('\n');
      const pick = prompt('Vyber kolekce tak, Å¾e napÃ­Å¡eÅ¡ nÃ¡zvy oddÄ›lenÃ© ÄÃ¡rkou.\n\nDostupnÃ©:\n' + text + '\n\nPÅ™Ã­klad: VÅ¡e, Chci jÃ­st', current.join(', '));
      if(pick === null) return;
      const next = pick.split(',').map(s=>s.trim()).filter(Boolean);
      setOfferCollections(o.id, next.length ? next : ['VÅ¡e']);
      toast('UloÅ¾eno do kolekcÃ­');
      renderDetail();
    });

    // detail share
    el.dShare.addEventListener('click', async ()=>{
      const o = filtered[state.detailIndex];
      if(!o) return;
      const shareData = { title: o.title, text: `${o.title} â€“ -${o.discount||0}%`, url: location.href.split('#')[0] };
      try{
        if(navigator.share){
          await navigator.share(shareData);
        } else {
          await navigator.clipboard.writeText(`${o.title} (-${o.discount||0}%)`);
          toast('ZkopÃ­rovÃ¡no');
        }
      }catch(e){
        toast('SdÃ­lenÃ­ zruÅ¡eno');
      }
    });

    // keyboard
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){
        // zavÅ™i top modal
        if(!el.detailModal.classList.contains('hidden')) return closeModal(el.detailModal);
        if(!el.savedModal.classList.contains('hidden')) return closeModal(el.savedModal);
        if(!el.filtersModal.classList.contains('hidden')) return closeModal(el.filtersModal);
        if(!el.sortModal.classList.contains('hidden')) return closeModal(el.sortModal);
      }

      if(!el.detailModal.classList.contains('hidden')){
        if(e.key === 'ArrowLeft') el.btnPrev.click();
        if(e.key === 'ArrowRight') el.btnNext.click();
        if(e.key === 'Enter') el.dCta.click();
      }
    });
  }

  function stylePill(btn, active){
    btn.className = "pill focus-ring h-11 px-4 rounded-2xl border text-sm " + (active ? "bg-white/12 border-white/20" : "bg-white/5 border-white/10 hover:bg-white/10");
  }

  // ====== INIT ======
  function init(){
    loadState();

    el.year.textContent = String(new Date().getFullYear());

    // set UI from state
    el.q.value = state.q || '';

    // activate category tab
    $$('.catBtn').forEach(x => x.classList.remove('bg-white/12','border-white/20'));
    const activeTab = $(`.catBtn[data-cat="${state.cat}"]`);
    if(activeTab) activeTab.classList.add('bg-white/12','border-white/20');
    else $(`.catBtn[data-cat="all"]`)?.classList.add('bg-white/12','border-white/20');

    // filter sheet values
    el.priceMin.value = state.priceMin;
    el.priceMax.value = state.priceMax;

    // tags
    renderTagsBox();

    // bind
    bindTop();

    // first render
    render();

    // warm toast
    setTimeout(()=> toast('VÃ­tej v SLEVAO prototypu âœ¨'), 400);
  }

  // go
  init();
</script>

</body>
</html>
