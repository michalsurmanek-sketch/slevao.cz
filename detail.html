<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />
  <title>SLEVAO â€“ Detail</title>
  <meta name="description" content="SLEVAO â€“ detail nabÃ­dky (uloÅ¾it, kolekce, sdÃ­lenÃ­)." />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          boxShadow: {
            soft: "0 20px 55px rgba(0,0,0,0.45)",
            glow: "0 0 0 1px rgba(255,255,255,0.08), 0 18px 60px rgba(236,72,153,0.20)",
          },
          borderRadius: {
            "3xl": "1.75rem",
            "4xl": "2.25rem",
          }
        }
      }
    }
  </script>

  <style>
    :root{ --bg0:#070b14; --bg1:#0b1220; }
    html,body{ height:100%; }
    body{
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(236,72,153,.20), transparent 60%),
        radial-gradient(900px 600px at 85% 15%, rgba(245,158,11,.18), transparent 55%),
        radial-gradient(900px 700px at 55% 85%, rgba(16,185,129,.12), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color:#fff;
    }
    .glass{ background: rgba(15,23,42,.55); backdrop-filter: blur(14px); }
    .focus-ring:focus{ outline:none; box-shadow: 0 0 0 3px rgba(56,189,248,.35); }
    body.modal-open{ overflow:hidden; }
    *{ -webkit-tap-highlight-color: rgba(236,72,153,.18); }
    ::-webkit-scrollbar{ height:10px; width:10px; }
    ::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.16); border-radius:999px; }
    ::-webkit-scrollbar-track{ background: rgba(255,255,255,.05); }
  </style>
</head>
<body class="min-h-screen">

<header class="sticky top-0 z-40">
  <div class="glass border-b border-white/10">
    <div class="max-w-6xl mx-auto px-4 py-3 md:py-4 flex items-center gap-3">
      <a href="./index.html" class="flex items-center gap-2" title="ZpÄ›t na feed">
        <span class="inline-flex h-10 w-10 rounded-2xl bg-gradient-to-br from-fuchsia-500/30 via-neutral-900 to-amber-500/20 border border-white/10 shadow-soft items-center justify-center">âœ¨</span>
        <div class="leading-tight">
          <div class="flex items-center gap-2">
            <span class="text-lg md:text-xl font-extrabold tracking-tight">SLEVAO</span>
            <span class="hidden sm:inline-flex text-xs px-2 py-0.5 rounded-full border border-white/10 bg-white/5 text-white/70">Detail</span>
          </div>
          <div class="text-xs text-white/60 -mt-0.5" id="crumb">â€”</div>
        </div>
      </a>

      <div class="ml-auto flex items-center gap-2">
        <a href="./reels.html" class="focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">ğŸ¬</a>
        <a href="./collections.html" class="focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">ğŸ“</a>
        <a href="./account.html" class="focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">ğŸ‘¤</a>
      </div>
    </div>
  </div>
</header>

<main class="max-w-6xl mx-auto px-4 py-6 md:py-10">

  <!-- HERO -->
  <section class="grid lg:grid-cols-[1.2fr_.8fr] gap-5 items-start">

    <!-- MEDIA CARD -->
    <div class="rounded-4xl border border-white/10 bg-white/5 shadow-glow overflow-hidden">
      <div class="relative aspect-[16/11] bg-black">
        <img id="img" alt="" class="w-full h-full object-cover" />
        <div class="absolute inset-0 bg-gradient-to-t from-black/85 via-black/15 to-black/35"></div>
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_10%,rgba(255,255,255,.10),transparent_55%)]"></div>

        <div class="absolute top-3 left-3 right-3 flex items-center justify-between gap-2">
          <div class="flex flex-wrap items-center gap-2">
            <span id="badge" class="inline-flex items-center gap-2 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">âœ¨ SLEVAO</span>
            <span id="disc" class="inline-flex items-center gap-1 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">ğŸ·ï¸ <b class="font-extrabold">-0%</b></span>
            <span id="exp" class="inline-flex items-center gap-1 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">â³ PlatÃ­</span>
            <span id="tag" class="inline-flex items-center gap-1 text-xs px-3 py-1 rounded-full border border-white/15 bg-white/10">#</span>
          </div>

          <button id="btnSave" class="focus-ring h-11 px-4 rounded-2xl bg-white/10 border border-white/15 hover:bg-white/15">ğŸ¤</button>
        </div>

        <div class="absolute bottom-3 left-3 right-3">
          <div id="title" class="text-2xl md:text-3xl font-extrabold leading-tight">â€”</div>
          <div id="sub" class="mt-1 text-white/75">â€”</div>

          <div class="mt-3 flex flex-wrap items-center justify-between gap-3">
            <div class="text-base">
              <span id="old" class="line-through text-white/40">0 KÄ</span>
              <span id="neu" class="ml-2 font-extrabold">0 KÄ</span>
            </div>

            <div class="flex items-center gap-2">
              <button id="btnShare" class="focus-ring h-11 px-5 rounded-2xl bg-white/10 border border-white/15 hover:bg-white/15">ğŸ”— SdÃ­let</button>
              <a id="btnGo" target="_blank" rel="noopener" class="focus-ring h-11 px-5 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-sky-500/10 border border-white/10 hover:opacity-95">â†—ï¸ OtevÅ™Ã­t nabÃ­dku</a>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- INFO CARD -->
    <aside class="rounded-4xl border border-white/10 bg-white/5 shadow-soft overflow-hidden">
      <div class="p-4 border-b border-white/10 flex items-center justify-between">
        <div class="font-extrabold">Info</div>
        <button id="btnToCollection" class="focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">ğŸ“ UloÅ¾it do kolekce</button>
      </div>
      <div class="p-4 md:p-6 space-y-4">
        <div class="rounded-3xl border border-white/10 bg-white/5 p-4">
          <div class="text-xs text-white/60">Popis</div>
          <div id="story" class="mt-2 text-white/80 leading-relaxed">â€”</div>
        </div>

        <div class="grid sm:grid-cols-2 gap-3">
          <div class="rounded-3xl border border-white/10 bg-white/5 p-4">
            <div class="text-xs text-white/60">Kategorie</div>
            <div id="cat" class="mt-1 font-extrabold">â€”</div>
          </div>
          <div class="rounded-3xl border border-white/10 bg-white/5 p-4">
            <div class="text-xs text-white/60">Zdroj</div>
            <div id="source" class="mt-1 font-extrabold">â€”</div>
          </div>
        </div>

        <div class="rounded-3xl border border-white/10 bg-white/5 p-4">
          <div class="text-xs text-white/60">Å tÃ­tky</div>
          <div id="tags" class="mt-2 flex flex-wrap gap-2"></div>
        </div>

        <div class="text-xs text-white/55">
          Data: <code class="px-2 py-1 rounded-xl bg-white/5 border border-white/10">slevao_offers_v1</code> â€¢
          UloÅ¾enÃ©: <code class="px-2 py-1 rounded-xl bg-white/5 border border-white/10">slevao_saved_v1</code> â€¢
          Kolekce: <code class="px-2 py-1 rounded-xl bg-white/5 border border-white/10">slevao_collections_v2</code>
        </div>
      </div>
    </aside>

  </section>

  <!-- RELATED -->
  <section class="mt-6 md:mt-10 rounded-4xl border border-white/10 bg-white/5 shadow-soft overflow-hidden">
    <div class="p-4 border-b border-white/10 flex items-center justify-between">
      <div class="font-extrabold">PodobnÃ© nabÃ­dky</div>
      <a href="./index.html" class="text-sm text-white/70 hover:text-white">ZpÄ›t na feed â†’</a>
    </div>
    <div id="related" class="p-4 grid sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>
  </section>

</main>

<!-- MODAL: PICK COLLECTION -->
<div id="modal" class="hidden fixed inset-0 z-50">
  <div id="backdrop" class="absolute inset-0 bg-black/60"></div>
  <div class="absolute inset-0">
    <div class="max-w-3xl mx-auto h-full px-3 py-3 md:py-10">
      <div class="h-full rounded-4xl overflow-hidden border border-white/10 shadow-glow bg-[#050812]">
        <div class="p-4 border-b border-white/10 flex items-center justify-between">
          <div class="font-extrabold">ğŸ“ UloÅ¾it do kolekce</div>
          <button id="btnClose" class="focus-ring h-10 px-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">ZavÅ™Ã­t</button>
        </div>

        <div class="h-[calc(100%-64px)] overflow-y-auto p-4 md:p-6">
          <div class="flex items-center gap-2">
            <input id="cq" class="focus-ring w-full h-11 rounded-2xl bg-white/5 border border-white/10 px-3" placeholder="Hledej kolekciâ€¦" />
            <button id="btnNewCol" class="focus-ring h-11 px-5 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10">+ NovÃ¡</button>
          </div>

          <div id="colList" class="mt-4 divide-y divide-white/10 rounded-3xl border border-white/10 overflow-hidden"></div>
          <div id="colEmpty" class="hidden mt-6 text-center text-white/70">ZatÃ­m nemÃ¡Å¡ Å¾Ã¡dnÃ© kolekce. Klikni â€+ NovÃ¡â€œ.</div>

          <div class="mt-4 text-xs text-white/55">
            Klikni na kolekci pro <b>pÅ™idat/odebrat</b> tuto nabÃ­dku.
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast" class="hidden fixed left-1/2 -translate-x-1/2 bottom-6 z-[60]">
  <div class="rounded-2xl border border-white/10 bg-[#0b1220] shadow-soft px-4 py-3 text-sm"></div>
</div>

<script>
  const KEY_OFFERS = 'slevao_offers_v1';
  const KEY_SAVED  = 'slevao_saved_v1';
  const KEY_COLS   = 'slevao_collections_v2';

  const $ = (s,r=document)=>r.querySelector(s);
  const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));
  const safeJson = (v,f)=>{ try{return JSON.parse(v)}catch(e){return f} };
  const fmtCZK = (n) => new Intl.NumberFormat('cs-CZ').format(Math.round(Number(n)||0)) + ' KÄ';

  const el = {
    img: $('#img'),
    badge: $('#badge'),
    disc: $('#disc'),
    exp: $('#exp'),
    tag: $('#tag'),
    title: $('#title'),
    sub: $('#sub'),
    old: $('#old'),
    neu: $('#neu'),
    btnSave: $('#btnSave'),
    btnShare: $('#btnShare'),
    btnGo: $('#btnGo'),

    crumb: $('#crumb'),
    story: $('#story'),
    cat: $('#cat'),
    source: $('#source'),
    tags: $('#tags'),

    related: $('#related'),

    btnToCollection: $('#btnToCollection'),

    modal: $('#modal'),
    backdrop: $('#backdrop'),
    btnClose: $('#btnClose'),
    cq: $('#cq'),
    btnNewCol: $('#btnNewCol'),
    colList: $('#colList'),
    colEmpty: $('#colEmpty'),

    toast: $('#toast')
  };

  let offers = [];
  let offer = null;
  let saved = [];
  let cols = [];

  function toast(msg){
    el.toast.firstElementChild.textContent = msg;
    el.toast.classList.remove('hidden');
    setTimeout(()=> el.toast.classList.add('hidden'), 2200);
  }

  function expLabel(d){
    d = Number(d||0);
    if(d===0) return 'KonÄÃ­ dnes';
    if(d===1) return 'KonÄÃ­ zÃ­tra';
    if(d<=7) return `KonÄÃ­ za ${d} dny`;
    return `PlatÃ­ jeÅ¡tÄ› ${d} dnÃ­`;
  }

  function catLabel(cat){
    if(cat==='food') return 'ğŸ” GURMAO Â· JÃ­dlo';
    if(cat==='stay') return 'ğŸ•ï¸ CHATAO Â· Pobyt';
    return 'ğŸ›ï¸ SLEVAO Â· Produkty';
  }

  function escapeHtml(str){
    return String(str||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
  }

  function loadOffers(){
    const arr = safeJson(localStorage.getItem(KEY_OFFERS), []);
    return Array.isArray(arr) ? arr : [];
  }

  function loadSaved(){
    const arr = safeJson(localStorage.getItem(KEY_SAVED), []);
    return Array.isArray(arr) ? arr : [];
  }

  function saveSaved(arr){
    localStorage.setItem(KEY_SAVED, JSON.stringify(Array.isArray(arr)?arr:[]));
  }

  function loadCols(){
    const arr = safeJson(localStorage.getItem(KEY_COLS), []);
    return Array.isArray(arr) ? arr : [];
  }

  function saveCols(arr){
    localStorage.setItem(KEY_COLS, JSON.stringify(Array.isArray(arr)?arr:[]));
  }

  function setSavedUI(isSaved){
    el.btnSave.textContent = isSaved ? 'â¤ï¸' : 'ğŸ¤';
  }

  async function shareLink(url){
    try{
      if(navigator.share){
        await navigator.share({ title: offer?.title || 'SLEVAO', url });
        toast('SdÃ­leno âœ…');
      } else {
        await navigator.clipboard.writeText(url);
        toast('Link zkopÃ­rovÃ¡n âœ…');
      }
    }catch(e){ toast('SdÃ­lenÃ­ zruÅ¡eno'); }
  }

  function renderTags(tags){
    const arr = Array.isArray(tags) ? tags : [];
    el.tags.innerHTML = arr.length ? arr.map(t=>`<span class="text-xs px-3 py-1 rounded-full border border-white/10 bg-white/5 text-white/70">#${escapeHtml(t)}</span>`).join('') : '<span class="text-white/60">â€”</span>';
  }

  function renderOffer(o){
    if(!o){
      document.title = 'SLEVAO â€“ Detail';
      toast('Nenalezeno');
      return;
    }

    const img = o.img || 'https://images.unsplash.com/photo-1520975682031-a4fe3c694bcd?auto=format&fit=crop&w=1600&q=80';
    el.img.src = img;

    el.badge.textContent = catLabel(o.cat);
    el.disc.innerHTML = `ğŸ·ï¸ <b class="font-extrabold">-${Number(o.discount||0)}%</b>`;
    el.exp.textContent = `â³ ${expLabel(o.expiresInDays)}`;
    el.tag.textContent = `#${(o.tags && o.tags[0]) ? o.tags[0] : 'sleva'}`;

    el.title.textContent = o.title || 'â€”';
    el.sub.textContent = o.subtitle || 'â€”';
    el.old.textContent = fmtCZK(o.oldPrice||0);
    el.neu.textContent = fmtCZK(o.newPrice||0);

    el.crumb.textContent = `${catLabel(o.cat)} â€¢ ${expLabel(o.expiresInDays)}`;

    el.story.textContent = o.story || 'â€”';
    el.cat.textContent = catLabel(o.cat);
    el.source.textContent = o.source || 'â€”';
    renderTags(o.tags);

    el.btnGo.href = o.link || '#';
    el.btnGo.classList.toggle('opacity-50', !o.link);
    el.btnGo.classList.toggle('pointer-events-none', !o.link);

    setSavedUI(saved.includes(o.id));

    document.title = `${o.title} â€“ SLEVAO`;

    // shareable URL
    const u = new URL(location.href);
    u.searchParams.set('id', o.id);
    history.replaceState({}, '', u);

    renderRelated(o);
  }

  function renderRelated(o){
    const sameCat = offers.filter(x=>x.id!==o.id && x.cat===o.cat);
    const pool = sameCat.length ? sameCat : offers.filter(x=>x.id!==o.id);
    const pick = pool.slice(0, 8);

    el.related.innerHTML = pick.map(x=>`
      <a href="./detail.html?id=${encodeURIComponent(x.id)}" class="block rounded-3xl border border-white/10 bg-white/5 overflow-hidden hover:bg-white/10 transition">
        <div class="aspect-[4/5] bg-black">
          <img src="${escapeHtml(x.img||'')}" class="w-full h-full object-cover" alt="" />
        </div>
        <div class="p-3">
          <div class="font-extrabold truncate">${escapeHtml(x.title||'â€”')}</div>
          <div class="text-xs text-white/70 truncate">-${Number(x.discount||0)}% â€¢ ${escapeHtml(catLabel(x.cat))}</div>
        </div>
      </a>
    `).join('');

    if(!pick.length){
      el.related.innerHTML = '<div class="text-white/60">ZatÃ­m nic dalÅ¡Ã­ho.</div>';
    }
  }

  function toggleSave(){
    if(!offer) return;
    const i = saved.indexOf(offer.id);
    if(i >= 0) saved.splice(i,1);
    else saved.push(offer.id);
    saveSaved(saved);
    setSavedUI(saved.includes(offer.id));
    toast(saved.includes(offer.id) ? 'UloÅ¾eno â¤ï¸' : 'OdebrÃ¡no');
  }

  // Collections modal
  function openModal(){
    cols = loadCols();
    el.cq.value = '';
    el.modal.classList.remove('hidden');
    document.body.classList.add('modal-open');
    renderColList();
  }

  function closeModal(){
    el.modal.classList.add('hidden');
    document.body.classList.remove('modal-open');
  }

  function colContains(c, offerId){
    return Array.isArray(c.items) && c.items.includes(offerId);
  }

  function renderColList(){
    const q = (el.cq.value||'').trim().toLowerCase();
    const shown = cols.filter(c => {
      if(!q) return true;
      const hay = `${c.name} ${c.desc||''}`.toLowerCase();
      return hay.includes(q);
    });

    el.colEmpty.classList.toggle('hidden', cols.length !== 0);

    el.colList.innerHTML = shown.map(c=>{
      const has = offer ? colContains(c, offer.id) : false;
      return `
        <button class="colrow w-full text-left p-4 hover:bg-white/10 transition" data-id="${escapeHtml(c.id)}">
          <div class="flex items-center gap-3">
            <div class="h-11 w-11 rounded-2xl bg-white/5 border border-white/10 grid place-items-center">ğŸ“</div>
            <div class="flex-1 min-w-0">
              <div class="font-extrabold truncate">${escapeHtml(c.name)}</div>
              <div class="text-xs text-white/60 truncate">${escapeHtml(c.desc||'â€”')}</div>
            </div>
            <div class="text-sm">
              <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-white/10 ${has ? 'bg-emerald-500/15' : 'bg-white/5'}">
                ${has ? 'âœ… V kolekci' : 'ï¼‹ PÅ™idat'}
              </span>
            </div>
          </div>
        </button>
      `;
    }).join('');

    $$('.colrow', el.colList).forEach(b=>{
      b.addEventListener('click', ()=> toggleInCol(b.getAttribute('data-id')));
    });
  }

  function toggleInCol(colId){
    if(!offer) return;
    const c = cols.find(x=>x.id===colId);
    if(!c) return;
    if(!Array.isArray(c.items)) c.items = [];

    const i = c.items.indexOf(offer.id);
    if(i >= 0) c.items.splice(i,1);
    else c.items.unshift(offer.id);

    c.updatedAt = Date.now();
    saveCols(cols);

    toast(i >= 0 ? 'OdebrÃ¡no z kolekce' : 'PÅ™idÃ¡no do kolekce âœ…');
    renderColList();
  }

  function uid(){
    return Math.random().toString(16).slice(2) + Date.now().toString(16);
  }

  function newCol(){
    const name = prompt('NÃ¡zev novÃ© kolekce');
    if(!name) return;
    const desc = prompt('Popis (volitelnÃ©)') || '';
    const c = { id: uid(), name: name.trim(), desc: desc.trim(), items: [], createdAt: Date.now(), updatedAt: Date.now() };
    cols.unshift(c);
    saveCols(cols);
    toast('Kolekce vytvoÅ™ena âœ…');
    renderColList();
  }

  // init
  offers = loadOffers();
  saved = loadSaved();
  cols = loadCols();

  const params = new URLSearchParams(location.search);
  const id = params.get('id');
  offer = offers.find(x=>String(x.id)===String(id)) || offers[0] || null;

  renderOffer(offer);
  toast('Detail pÅ™ipraven âœ¨');

  // bind
  el.btnSave.addEventListener('click', toggleSave);
  el.btnShare.addEventListener('click', ()=> shareLink(location.href));

  el.btnToCollection.addEventListener('click', openModal);
  el.backdrop.addEventListener('click', closeModal);
  el.btnClose.addEventListener('click', closeModal);
  el.cq.addEventListener('input', renderColList);
  el.btnNewCol.addEventListener('click', newCol);

  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape' && !el.modal.classList.contains('hidden')) closeModal();
  });
</script>
</body>
</html>
